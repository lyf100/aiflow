# AIFlow æ¶æ„è®¾è®¡æ–‡æ¡£

**Architecture Design Document for AIFlow Code Behavior Sandbox**

---

## ğŸ“‹ ç›®å½•

1. [è®¾è®¡å“²å­¦](#è®¾è®¡å“²å­¦)
2. [æ ¸å¿ƒæ¶æ„](#æ ¸å¿ƒæ¶æ„)
3. [æ•°æ®æµè½¬](#æ•°æ®æµè½¬)
4. [å…³é”®è®¾è®¡å†³ç­–](#å…³é”®è®¾è®¡å†³ç­–)
5. [æŠ€æœ¯é€‰å‹ç†ç”±](#æŠ€æœ¯é€‰å‹ç†ç”±)
6. [æ‰©å±•æ€§è®¾è®¡](#æ‰©å±•æ€§è®¾è®¡)
7. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)

---

## ğŸ¯ è®¾è®¡å“²å­¦

### 1. æ™ºèƒ½å§”æ‰˜ç­–ç•¥ï¼ˆIntelligent Delegationï¼‰

**æ ¸å¿ƒç†å¿µ**ï¼šå¹³å°ä¸åšè§£æï¼ŒåªåšæŒ‡æŒ¥ã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼š
  ä»£ç  â†’ è‡ªå»ºè§£æå™¨ â†’ AST â†’ åˆ†æé€»è¾‘ â†’ ç»“æœ

AIFlow æ–¹å¼ï¼š
  ä»£ç  â†’ æ ¸å¿ƒæŒ‡ä»¤é›† â†’ AIå·¥å…·ï¼ˆè§£æ+åˆ†æ+è¯­ä¹‰ç†è§£ï¼‰ â†’ æ ‡å‡†JSON â†’ å¯è§†åŒ–
```

#### ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

1. **ä¸“ä¸šåˆ†å·¥**
   - AI æ“…é•¿ï¼šè¯­ä¹‰ç†è§£ã€ä¸šåŠ¡æ¨ç†ã€æ¨¡å—å‘½å
   - å¹³å°æ“…é•¿ï¼šæ•°æ®åè®®ã€å¯è§†åŒ–ã€ç”¨æˆ·äº¤äº’

2. **è·¨è¯­è¨€æ”¯æŒ**
   - æ— éœ€ä¸ºæ¯ç§è¯­è¨€ç¼–å†™è§£æå™¨
   - AI å¤©ç„¶æ”¯æŒå¤šè¯­è¨€ç†è§£

3. **é™ä½ç»´æŠ¤æˆæœ¬**
   - è¯­è¨€è¯­æ³•æ›´æ–°ç”± AI æ¨¡å‹è‡ªåŠ¨é€‚åº”
   - å¹³å°åªéœ€ç»´æŠ¤æŒ‡ä»¤é›†å’Œæ•°æ®åè®®

### 2. æŠ€æœ¯æ ˆæ— å…³æ€§ï¼ˆTechnology Agnosticï¼‰

**æ ¸å¿ƒç†å¿µ**ï¼šä½œä¸º"æ— å¤–å£³"çš„ MCP å·¥å…·ï¼Œä¸å…·ä½“ AI æœåŠ¡è§£è€¦ã€‚

#### SPIï¼ˆService Provider Interfaceï¼‰è®¾è®¡

```python
# æŠ½è±¡æ¥å£
class BaseAIAdapter(ABC):
    @abstractmethod
    async def generate(self, prompt: str) -> AIResponse:
        pass

# å…·ä½“å®ç°
class ClaudeAdapter(BaseAIAdapter):
    async def generate(self, prompt: str) -> AIResponse:
        # Claude-specific implementation

class OpenAIAdapter(BaseAIAdapter):
    async def generate(self, prompt: str) -> AIResponse:
        # OpenAI-specific implementation
```

#### ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

1. **é™ä½ä¾›åº”å•†é”å®šé£é™©**
   - AI æœåŠ¡å¯æ›¿æ¢
   - ä¸ä¾èµ–å•ä¸€å‚å•†

2. **å¤šæ¨¡å‹ååŒ**
   - ä¸åŒé˜¶æ®µä½¿ç”¨ä¸åŒæ¨¡å‹
   - Claude æ“…é•¿æ¨ç†ï¼ŒGPT-4 æ“…é•¿åˆ›é€ 

3. **æˆæœ¬ä¼˜åŒ–**
   - æŒ‰éœ€é€‰æ‹©æ€§ä»·æ¯”æœ€é«˜çš„æ¨¡å‹
   - æ”¯æŒæœ¬åœ°å¼€æºæ¨¡å‹

### 3. å±‚çº§ä¸è¡Œä¸ºç»Ÿä¸€ï¼ˆUnified Hierarchy & Behaviorï¼‰

**æ ¸å¿ƒç†å¿µ**ï¼šä¼ ç»Ÿå·¥å…·å°†ç»“æ„å’Œè¡Œä¸ºåˆ†ç¦»ï¼ŒAIFlow æ·±åº¦èåˆã€‚

#### ä¼ ç»Ÿå·¥å…·çš„é—®é¢˜

```
é™æ€åˆ†æå·¥å…·ï¼š
  âœ… å±•ç¤ºä»£ç ç»“æ„
  âŒ ä¸çŸ¥é“å¦‚ä½•è¿è¡Œ
  âŒ æ— æ³•ç†è§£ä¸šåŠ¡å«ä¹‰

åŠ¨æ€è°ƒè¯•å·¥å…·ï¼š
  âœ… å±•ç¤ºæ‰§è¡Œæµç¨‹
  âŒ ç¼ºå¤±å®è§‚æ¶æ„è§†è§’
  âŒ æ— æ³•ç†è§£æ¨¡å—ååŒ
```

#### AIFlow çš„è§£å†³æ–¹æ¡ˆ

```
ç»Ÿä¸€æ²™ç›˜ï¼š
  âœ… ä»£ç ç»“æ„æœ¬èº«æ˜¯äº¤äº’å¼çš„
  âœ… æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å¯åŠ¨æŒ‰é’®
  âœ… å¯ä»¥åœ¨ä»»æ„å±‚çº§è§‚å¯Ÿè¡Œä¸º
  âœ… å®è§‚æ¶æ„å’Œå¾®è§‚å®ç°æ— ç¼åˆ‡æ¢
```

### 4. åµŒå¥—å¼è¡Œä¸ºå¯åŠ¨ï¼ˆNested Behavior Launchï¼‰

**æ ¸å¿ƒåˆ›æ–°**ï¼šå¤šå±‚çº§ã€å¯åµŒå¥—çš„æ‰§è¡Œè½¨è¿¹ã€‚

#### ä¸‰å±‚æŒ‰é’®ä½“ç³»

```
ğŸ“¦ System Level (å¤§æŒ‰é’® - Macro)
  ä½œç”¨: å¯åŠ¨ç³»ç»Ÿçº§å¤šæµç¨‹è”åŠ¨
  ç¤ºä¾‹: "å®Œæ•´ç”¨æˆ·æ³¨å†Œæµç¨‹"
  ç‰¹ç‚¹: æ¶‰åŠå¤šä¸ªæ¨¡å—ååŒ

  â”œâ”€ ğŸ“‚ Module Level (å°æŒ‰é’® - Micro)
  â”‚   ä½œç”¨: å¯åŠ¨å­æ¨¡å—ç‹¬ç«‹æµç¨‹
  â”‚   ç¤ºä¾‹: "é‚®ç®±éªŒè¯"
  â”‚   ç‰¹ç‚¹: å•ä¸€æ¨¡å—å†…çš„å®Œæ•´ä¸šåŠ¡
  â”‚
  â”‚   â””â”€ ğŸ”§ Function Level (å¾®æŒ‰é’® - Function)
  â”‚       ä½œç”¨: å•æ­¥æ‰§è¡Œå‡½æ•°é€»è¾‘
  â”‚       ç¤ºä¾‹: "validateEmail()"
  â”‚       ç‰¹ç‚¹: å•ä¸ªå‡½æ•°çš„æ‰§è¡Œè½¨è¿¹
```

#### æ•°æ®ç»“æ„è®¾è®¡

```typescript
interface LaunchButton {
  id: string;                      // UUID v4
  node_id: string;                // å…³è”çš„ä»£ç èŠ‚ç‚¹
  name: string;                   // AI ç”Ÿæˆçš„ä¸šåŠ¡åç§°
  type: "macro" | "micro";        // æŒ‰é’®ç±»å‹
  level: "system" | "module" | "component" | "function";

  // åµŒå¥—å…³ç³»
  parent_button_id: string | null;  // çˆ¶æŒ‰é’®ID
  child_button_ids: string[];       // å­æŒ‰é’®IDåˆ—è¡¨

  // æ‰§è¡Œå…³è”
  traceable_unit_id: string;        // å…³è”çš„æ‰§è¡Œè½¨è¿¹

  // AI å…ƒæ•°æ®
  metadata: {
    ai_confidence: number;          // AI æ¨ç†ç½®ä¿¡åº¦
    ai_explanation: string;         // å‘½åå’ŒåŠŸèƒ½æ¨ç†ä¾æ®
    estimated_duration: number;     // é¢„ä¼°æ‰§è¡Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    requires_input: boolean;        // æ˜¯å¦éœ€è¦ç”¨æˆ·è¾“å…¥
    has_side_effects: boolean;      // æ˜¯å¦æœ‰å‰¯ä½œç”¨
  };
}
```

### 5. å¹¶å‘è¡Œä¸ºç²¾ç¡®è¡¨è¾¾ï¼ˆPrecise Concurrency Expressionï¼‰

**æ ¸å¿ƒç†å¿µ**ï¼šç°ä»£è½¯ä»¶å……æ»¡å¹¶å‘ï¼Œå¿…é¡»ç²¾ç¡®è¡¨è¾¾ã€‚

#### ä¸‰ç§å¹¶å‘è¡¨è¾¾æ–¹å¼

**æ–¹å¼ 1ï¼šæ—¶åºå›¾ï¼ˆSequence Diagramï¼‰**
```
é€‚ç”¨åœºæ™¯: å¼‚æ­¥æ¶ˆæ¯ä¼ é€’ã€æœåŠ¡è°ƒç”¨
è¡¨è¾¾èƒ½åŠ›:
  - ç”Ÿå‘½çº¿ï¼ˆLifelineï¼‰
  - åŒæ­¥/å¼‚æ­¥æ¶ˆæ¯
  - è¿”å›å€¼
  - å¹¶è¡Œæ‰§è¡ŒåŒºåŸŸ
```

**æ–¹å¼ 2ï¼šæµç¨‹å›¾ï¼ˆFlowchartï¼‰**
```
é€‚ç”¨åœºæ™¯: çº¿ç¨‹åˆ†å‰/æ±‡åˆã€å¹¶å‘æ§åˆ¶
è¡¨è¾¾èƒ½åŠ›:
  - fork èŠ‚ç‚¹ï¼ˆå¹¶å‘åˆ†å‰ï¼‰
  - join èŠ‚ç‚¹ï¼ˆå¹¶å‘æ±‡åˆï¼‰
  - åŒæ­¥ç‚¹ï¼ˆSync Pointï¼‰
  - æ•°æ®æµå‘
```

**æ–¹å¼ 3ï¼šå¤šæµç¨‹è”åŠ¨åŠ¨ç”»ï¼ˆMulti-Flow Animationï¼‰**
```
é€‚ç”¨åœºæ™¯: ä¸»ç»“æ„å›¾ä¸Šçš„å¹¶å‘å¯è§†åŒ–
è¡¨è¾¾èƒ½åŠ›:
  - å¤šæ¡"è„‰å†²"åŒæ—¶æµåŠ¨
  - ä¸åŒé¢œè‰²åŒºåˆ†ä¸åŒæµç¨‹
  - å®æ—¶åŒæ­¥/å¼‚æ­¥çŠ¶æ€
  - çº¿ç¨‹/è¿›ç¨‹é—´é€šä¿¡
```

### 6. å…¨æ–¹ä½ç”¨æˆ·æ§åˆ¶ï¼ˆFull User Controlï¼‰

**æ ¸å¿ƒç†å¿µ**ï¼šç”¨æˆ·ä¸æ˜¯è§‚å¯Ÿè€…ï¼Œæ˜¯æ¢ç´¢è€…ã€‚

#### æ§åˆ¶ç»´åº¦

| ç»´åº¦ | æ§åˆ¶èƒ½åŠ› | å®ç°æ–¹å¼ |
|------|---------|----------|
| **æ—¶é—´æ§åˆ¶** | æ’­æ”¾/æš‚åœ/å›æº¯ | æ‰§è¡Œæ­¥éª¤ç´¢å¼• + æ—¶é—´è½´ |
| **ç©ºé—´æ§åˆ¶** | å±•å¼€/æŠ˜å /ç¼©æ”¾ | Cytoscape.js äº¤äº’ |
| **è§†è§’åˆ‡æ¢** | ç»“æ„å›¾ â†” æ—¶åºå›¾ â†” æµç¨‹å›¾ | å¤šè§†å›¾ååŒ |
| **ç»†èŠ‚æ¢ç´¢** | å•æ­¥è¯¦æƒ…/å˜é‡è¿½è¸ª | Monaco Editor + D3.js |
| **å¹¶å‘è§‚å¯Ÿ** | å¤šæµç¨‹åŒæ—¶æ’­æ”¾ | åŠ¨ç”»åŒæ­¥å¼•æ“ |

---

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ„

### ä¸‰å±‚æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ ¸å¿ƒæŒ‡ä»¤é›†å±‚ (Prompt Library)              â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Prompt æ¨¡æ¿åº“       â”‚    â”‚  Jinja2 æ¸²æŸ“å¼•æ“         â”‚  â”‚
â”‚  â”‚  - 5é˜¶æ®µåˆ†ææ¨¡æ¿     â”‚ â†’  â”‚  - æ¨¡æ¿å˜é‡æ›¿æ¢          â”‚  â”‚
â”‚  â”‚  - ç‰ˆæœ¬åŒ–ç®¡ç†        â”‚    â”‚  - è¾“å…¥æ•°æ®éªŒè¯          â”‚  â”‚
â”‚  â”‚  - è¯­è¨€ç‰¹å®šä¼˜åŒ–      â”‚    â”‚  - è‡ªå®šä¹‰è¿‡æ»¤å™¨          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   AI é€‚é…å™¨å±‚ (Adapter SPI)                  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Claude 4.5   â”‚  â”‚ OpenAI GPT-4 â”‚  â”‚ Google Geminiâ”‚      â”‚
â”‚  â”‚ Adapter      â”‚  â”‚ Adapter      â”‚  â”‚ Adapter      â”‚      â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚      â”‚
â”‚  â”‚ - é‡è¯•æœºåˆ¶   â”‚  â”‚ - æµå¼è¾“å‡º   â”‚  â”‚ - æœ¬åœ°ç¼“å­˜   â”‚      â”‚
â”‚  â”‚ - é€Ÿç‡é™åˆ¶   â”‚  â”‚ - å¹¶å‘æ§åˆ¶   â”‚  â”‚ - é”™è¯¯é™çº§   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ ‡å‡†æ•°æ®åè®®å±‚ (JSON Schema v1.0.0)             â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Protocol       â”‚  â”‚ Validator      â”‚  â”‚ Serializer   â”‚  â”‚
â”‚  â”‚ Entities       â”‚  â”‚                â”‚  â”‚              â”‚  â”‚
â”‚  â”‚                â”‚  â”‚ - Schemaæ ¡éªŒ   â”‚  â”‚ - JSONåºåˆ—åŒ– â”‚  â”‚
â”‚  â”‚ - TypedDict    â”‚  â”‚ - å¼•ç”¨å®Œæ•´æ€§   â”‚  â”‚ - gzipå‹ç¼©   â”‚  â”‚
â”‚  â”‚ - TypeScript   â”‚  â”‚ - æ—¶é—´æˆ³æ ¡éªŒ   â”‚  â”‚ - å¢é‡æ›´æ–°   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å¯è§†åŒ–å¼•æ“å±‚ (Visualization Engine)             â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚          Cytoscape.js (ä¸»å¼•æ“)                       â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  - è¡Œä¸ºæ²™ç›˜æ¸²æŸ“                                       â”‚  â”‚
â”‚  â”‚  - åµŒå¥—å¯åŠ¨æŒ‰é’®                                       â”‚  â”‚
â”‚  â”‚  - å¤šæµç¨‹è”åŠ¨åŠ¨ç”»                                     â”‚  â”‚
â”‚  â”‚  - å±‚çº§å±•å¼€/æŠ˜å                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ D3.js (è¾…åŠ©å¼•æ“)     â”‚    â”‚ Monaco Editor            â”‚  â”‚
â”‚  â”‚                      â”‚    â”‚                          â”‚  â”‚
â”‚  â”‚ - æ—¶åºå›¾             â”‚    â”‚ - ä»£ç é«˜äº®               â”‚  â”‚
â”‚  â”‚ - æµç¨‹å›¾             â”‚    â”‚ - å•æ­¥è¯¦æƒ…               â”‚  â”‚
â”‚  â”‚ - å˜é‡è¿½è¸ªå›¾         â”‚    â”‚ - è°ƒç”¨å †æ ˆ               â”‚  â”‚
â”‚  â”‚ - è°ƒç”¨å †æ ˆå¯è§†åŒ–     â”‚    â”‚ - å˜é‡ä½œç”¨åŸŸ             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å±‚çº§èŒè´£è¯¦è§£

#### Layer 1: æ ¸å¿ƒæŒ‡ä»¤é›†å±‚

**èŒè´£**ï¼š
- ç®¡ç† Prompt æ¨¡æ¿çš„ç‰ˆæœ¬å’Œæ³¨å†Œ
- æ¸²æŸ“æ¨¡æ¿å¹¶å¡«å……è¾“å…¥æ•°æ®
- éªŒè¯æ¨¡æ¿æ ¼å¼å’Œè¾“å…¥æ•°æ®å®Œæ•´æ€§

**å…³é”®ç»„ä»¶**ï¼š

```python
# Prompt æ¨¡æ¿ç®¡ç†å™¨
class PromptTemplateManager:
    def load_template(self, language, stage, version=None):
        """ä»æ³¨å†Œè¡¨åŠ è½½æ¨¡æ¿"""

    def get_template_by_id(self, template_id):
        """é€šè¿‡IDç›´æ¥è·å–æ¨¡æ¿"""

    def list_templates(self, filters=None):
        """åˆ—å‡ºæ‰€æœ‰å¯ç”¨æ¨¡æ¿"""

# Jinja2 æ¸²æŸ“å¼•æ“
class PromptRenderer:
    def render(self, language, stage, input_data, validate_input=True):
        """æ¸²æŸ“æ¨¡æ¿å¹¶è¿”å›å®Œæ•´Prompt"""

    def _register_filters(self):
        """æ³¨å†Œè‡ªå®šä¹‰Jinja2è¿‡æ»¤å™¨"""
```

**è®¾è®¡æ¨¡å¼**ï¼š
- **æ³¨å†Œè¡¨æ¨¡å¼**ï¼šregistry.yaml é›†ä¸­ç®¡ç†æ¨¡æ¿å…ƒæ•°æ®
- **æ¨¡æ¿æ–¹æ³•æ¨¡å¼**ï¼šç»Ÿä¸€çš„æ¸²æŸ“æµç¨‹
- **ç­–ç•¥æ¨¡å¼**ï¼šä¸åŒè¯­è¨€ä½¿ç”¨ä¸åŒæ¨¡æ¿ç­–ç•¥

#### Layer 2: AI é€‚é…å™¨å±‚

**èŒè´£**ï¼š
- ç»Ÿä¸€ä¸åŒ AI æœåŠ¡çš„æ¥å£
- å¤„ç†é‡è¯•ã€é€Ÿç‡é™åˆ¶ã€é”™è¯¯é™çº§
- æä¾›æµå¼å’Œéæµå¼ä¸¤ç§ç”Ÿæˆæ¨¡å¼

**å…³é”®ç»„ä»¶**ï¼š

```python
# æŠ½è±¡åŸºç±»
class BaseAIAdapter(ABC):
    @abstractmethod
    async def generate(self, prompt, **kwargs) -> AIResponse:
        """éæµå¼ç”Ÿæˆ"""

    @abstractmethod
    async def generate_stream(self, prompt, **kwargs) -> AsyncIterator[str]:
        """æµå¼ç”Ÿæˆ"""

    async def generate_with_retry(self, prompt, **kwargs):
        """å¸¦é‡è¯•çš„ç”Ÿæˆ"""
        # æŒ‡æ•°é€€é¿ç®—æ³•
        for attempt in range(max_retries):
            try:
                return await self.generate(prompt, **kwargs)
            except RateLimitError:
                delay = retry_delay * (2 ** attempt)
                await asyncio.sleep(delay)
```

**è®¾è®¡æ¨¡å¼**ï¼š
- **é€‚é…å™¨æ¨¡å¼**ï¼šç»Ÿä¸€ä¸åŒAIæœåŠ¡æ¥å£
- **å·¥å‚æ¨¡å¼**ï¼šcreate_xxx_adapter() å·¥å‚å‡½æ•°
- **ç­–ç•¥æ¨¡å¼**ï¼šé‡è¯•ç­–ç•¥ã€é™çº§ç­–ç•¥å¯é…ç½®

#### Layer 3: æ ‡å‡†æ•°æ®åè®®å±‚

**èŒè´£**ï¼š
- å®šä¹‰ç»Ÿä¸€çš„ JSON Schema
- éªŒè¯æ•°æ®å®Œæ•´æ€§å’Œå¼•ç”¨å®Œæ•´æ€§
- åºåˆ—åŒ–/ååºåˆ—åŒ–

**å…³é”®ç»„ä»¶**ï¼š

```python
# åè®®éªŒè¯å™¨
class ProtocolValidator:
    def validate_complete(self, data) -> ValidationResult:
        """8æ­¥å®Œæ•´éªŒè¯"""
        # 1. JSON Schema éªŒè¯
        # 2. æ—¶é—´æˆ³æ ¼å¼éªŒè¯
        # 3. UUID æ ¼å¼éªŒè¯
        # 4. å¼•ç”¨å®Œæ•´æ€§éªŒè¯ï¼ˆ10ç§å¼•ç”¨ç±»å‹ï¼‰
        # 5. æ‰§è¡Œé¡ºåºå”¯ä¸€æ€§éªŒè¯

# åºåˆ—åŒ–å™¨
class ProtocolSerializer:
    def serialize(self, data, output_path, compress=False):
        """åºåˆ—åŒ–ä¸ºJSONæ–‡ä»¶"""

    def update_partial(self, file_path, updates):
        """å¢é‡æ›´æ–°JSON"""
```

**è®¾è®¡æ¨¡å¼**ï¼š
- **æ„å»ºå™¨æ¨¡å¼**ï¼šé€æ­¥æ„å»ºå¤æ‚æ•°æ®ç»“æ„
- **ç»„åˆæ¨¡å¼**ï¼šåµŒå¥—çš„èŠ‚ç‚¹å’Œè¾¹ç»“æ„
- **éªŒè¯å™¨æ¨¡å¼**ï¼šå¤šå±‚éªŒè¯ç®¡é“

#### Layer 4: å¯è§†åŒ–å¼•æ“å±‚

**èŒè´£**ï¼š
- æ¸²æŸ“äº¤äº’å¼ä»£ç ç»“æ„å›¾
- å®ç°åµŒå¥—å¯åŠ¨æŒ‰é’®
- æ’­æ”¾å¤šæµç¨‹è”åŠ¨åŠ¨ç”»
- å±•ç¤ºå•æ­¥æ‰§è¡Œè¯¦æƒ…

**å…³é”®ç»„ä»¶**ï¼š

```typescript
// Cytoscape.js ä¸»å¼•æ“
class CodeStructureGraph {
  renderGraph(analysisData: AnalysisResult): void {
    // æ¸²æŸ“èŠ‚ç‚¹å’Œè¾¹
  }

  attachLaunchButtons(buttons: LaunchButton[]): void {
    // é™„åŠ åµŒå¥—å¯åŠ¨æŒ‰é’®
  }

  playMultiFlowAnimation(traces: TraceableUnit[]): void {
    // æ’­æ”¾å¤šæµç¨‹è”åŠ¨åŠ¨ç”»
  }
}

// D3.js è¾…åŠ©å¼•æ“
class ExecutionTraceVisualizer {
  renderSequenceDiagram(trace: SequenceTrace): void {
    // æ¸²æŸ“æ—¶åºå›¾
  }

  renderFlowchart(trace: FlowchartTrace): void {
    // æ¸²æŸ“æµç¨‹å›¾ï¼ˆæ”¯æŒfork/joinï¼‰
  }
}

// Monaco Editor å•æ­¥è¯¦æƒ…
class StepDetailsViewer {
  showStep(step: ExecutionStep): void {
    // æ˜¾ç¤ºä»£ç  + å˜é‡ + è°ƒç”¨æ ˆ
  }
}
```

**è®¾è®¡æ¨¡å¼**ï¼š
- **è§‚å¯Ÿè€…æ¨¡å¼**ï¼šUIç»„ä»¶è®¢é˜…æ•°æ®å˜åŒ–
- **å‘½ä»¤æ¨¡å¼**ï¼šæ’­æ”¾/æš‚åœ/å›æº¯å‘½ä»¤
- **çŠ¶æ€æ¨¡å¼**ï¼šåŠ¨ç”»æ’­æ”¾çŠ¶æ€ç®¡ç†

---

## ğŸ”„ æ•°æ®æµè½¬

### å®Œæ•´æ•°æ®æµ

```
1. ç”¨æˆ·è¾“å…¥
   â”œâ”€ é¡¹ç›®è·¯å¾„
   â”œâ”€ ç›®æ ‡è¯­è¨€
   â””â”€ åˆ†æé€‰é¡¹

2. Prompt æ¸²æŸ“
   â”œâ”€ é€‰æ‹©å¯¹åº”è¯­è¨€çš„æ¨¡æ¿
   â”œâ”€ å¡«å……è¾“å…¥æ•°æ®
   â””â”€ ç”Ÿæˆå®Œæ•´ Prompt

3. AI åˆ†æ
   â”œâ”€ é€šè¿‡é€‚é…å™¨å‘é€ Prompt
   â”œâ”€ AI æ‰§è¡Œæ·±åº¦åˆ†æ
   â””â”€ è¿”å› JSON ç»“æœ

4. æ•°æ®éªŒè¯
   â”œâ”€ JSON Schema éªŒè¯
   â”œâ”€ å¼•ç”¨å®Œæ•´æ€§éªŒè¯
   â””â”€ ä¸šåŠ¡è§„åˆ™éªŒè¯

5. æ•°æ®å­˜å‚¨
   â”œâ”€ åºåˆ—åŒ–ä¸º JSON æ–‡ä»¶
   â””â”€ å¯é€‰ gzip å‹ç¼©

6. å‰ç«¯åŠ è½½
   â”œâ”€ è¯»å– JSON æ–‡ä»¶
   â”œâ”€ TypeScript ç±»å‹éªŒè¯
   â””â”€ åŠ è½½åˆ° Zustand Store

7. å¯è§†åŒ–æ¸²æŸ“
   â”œâ”€ Cytoscape.js æ¸²æŸ“ç»“æ„å›¾
   â”œâ”€ ç”ŸæˆåµŒå¥—å¯åŠ¨æŒ‰é’®
   â””â”€ D3.js å‡†å¤‡è¾…åŠ©å›¾è¡¨

8. ç”¨æˆ·äº¤äº’
   â”œâ”€ ç‚¹å‡»å¯åŠ¨æŒ‰é’®
   â”œâ”€ æ’­æ”¾æ‰§è¡ŒåŠ¨ç”»
   â”œâ”€ æŸ¥çœ‹å•æ­¥è¯¦æƒ…
   â””â”€ åˆ‡æ¢ä¸åŒè§†å›¾
```

### å…³é”®æ•°æ®ç»“æ„

#### é¡¹ç›®å…ƒæ•°æ®ï¼ˆProject Metadataï¼‰

```typescript
interface ProjectMetadata {
  name: string;                    // é¡¹ç›®åç§°
  language: string;                // ä¸»è¦è¯­è¨€
  version: string;                 // é¡¹ç›®ç‰ˆæœ¬
  description: string;             // AIç”Ÿæˆçš„é¡¹ç›®æè¿°
  framework: string[];             // ä½¿ç”¨çš„æ¡†æ¶
  architecture_pattern: string[];  // æ¶æ„æ¨¡å¼ï¼ˆMVC, å¾®æœåŠ¡ç­‰ï¼‰
  entry_points: string[];          // å…¥å£æ–‡ä»¶
  dependencies: string[];          // ä¾èµ–åˆ—è¡¨
  complexity_score: number;        // å¤æ‚åº¦è¯„åˆ† (0-1)
}
```

#### ä»£ç ç»“æ„ï¼ˆCode Structureï¼‰

```typescript
interface CodeNode {
  id: string;                      // UUID v4
  label: string;                   // AIç”Ÿæˆçš„ä¸šåŠ¡åç§°
  stereotype: "system" | "module" | "class" | "function" | "service" | "component";
  parent: string | null;           // çˆ¶èŠ‚ç‚¹IDï¼ˆå±‚çº§å…³ç³»ï¼‰
  file_path: string;               // æ–‡ä»¶è·¯å¾„
  line_range: [number, number];    // è¡Œå·èŒƒå›´
  metadata: {
    visibility: "public" | "private" | "protected";
    is_async: boolean;
    is_exported: boolean;
    ai_confidence: number;
  };
}

interface CodeEdge {
  id: string;                      // UUID v4
  source: string;                  // æºèŠ‚ç‚¹ID
  target: string;                  // ç›®æ ‡èŠ‚ç‚¹ID
  relationship: "imports" | "calls" | "extends" | "implements" | "contains" | "depends_on";
  label: string;                   // è¾¹çš„æ ‡ç­¾
  weight: number;                  // æƒé‡ï¼ˆè°ƒç”¨é¢‘ç‡ã€ä¾èµ–å¼ºåº¦ï¼‰
}
```

#### å¯åŠ¨æŒ‰é’®ï¼ˆLaunch Buttonï¼‰

```typescript
interface LaunchButton {
  id: string;                      // UUID v4
  node_id: string;                // å…³è”çš„ä»£ç èŠ‚ç‚¹
  name: string;                   // AIç”Ÿæˆçš„æŒ‰é’®åç§°
  description: string;            // åŠŸèƒ½æè¿°
  type: "macro" | "micro";        // å¤§æŒ‰é’®/å°æŒ‰é’®
  level: "system" | "module" | "component" | "function";
  icon: string;                   // å›¾æ ‡åç§°

  // åµŒå¥—å…³ç³»
  parent_button_id: string | null;
  child_button_ids: string[];

  // æ‰§è¡Œå…³è”
  traceable_unit_id: string;      // å…³è”çš„æ‰§è¡Œè½¨è¿¹ID

  // AI å…ƒæ•°æ®
  metadata: {
    ai_confidence: number;        // 0-1
    ai_explanation: string;
    estimated_duration: number;   // æ¯«ç§’
    requires_input: boolean;
    has_side_effects: boolean;
  };
}
```

#### æ‰§è¡Œè½¨è¿¹ï¼ˆExecution Traceï¼‰

```typescript
interface TraceableUnit {
  id: string;                      // UUID v4
  name: string;                   // åœºæ™¯åç§°
  type: "i-trace";                // å¤šæµç¨‹è”åŠ¨ç±»å‹
  sub_unit_ids: string[];         // å­å•å…ƒIDï¼ˆæ”¯æŒåµŒå¥—ï¼‰
  level: "system" | "module" | "component" | "function";

  traces: Array<FlowchartTrace | SequenceTrace | StepByStepTrace>;
}

// æµç¨‹å›¾è½¨è¿¹
interface FlowchartTrace {
  format: "flowchart";
  data: {
    steps: Array<{
      id: string;
      label: string;
      type: "start" | "end" | "process" | "decision" | "fork" | "join";
    }>;
    connections: Array<{
      id: string;
      source: string;
      target: string;
      type: "control_flow" | "data_flow";
      label: string;
    }>;
  };
}

// æ—¶åºå›¾è½¨è¿¹
interface SequenceTrace {
  format: "sequence";
  data: {
    lifelines: Array<{
      id: string;
      label: string;
      type: "service" | "component" | "thread";
    }>;
    messages: Array<{
      id: string;
      source: string;
      target: string;
      type: "sync" | "async" | "return";
      timestamp: number;         // ç›¸å¯¹æ—¶é—´æˆ³
      label: string;
    }>;
  };
}

// å•æ­¥æ‰§è¡Œè½¨è¿¹
interface StepByStepTrace {
  format: "step-by-step";
  data: {
    steps: Array<{
      id: string;
      order: number;
      file_path: string;
      line_number: number;
      code: string;
      timestamp: string;         // ISO 8601
      execution_order: number;   // å…¨å±€å”¯ä¸€åºå·
      scope_id: string;          // å…³è”å˜é‡ä½œç”¨åŸŸ
    }>;
    variableScopes: Array<{
      id: string;
      scope_type: "global" | "local" | "closure";
      variables: Array<{
        name: string;
        type: string;
        value: string;
      }>;
      timestamp: string;
      execution_order: number;
    }>;
    callStack: Array<{
      id: string;
      function_name: string;
      module_name: string;
      file_path: string;
      line_number: number;
      depth: number;             // è°ƒç”¨æ·±åº¦
      timestamp: string;
      execution_order: number;
    }>;
  };
}
```

---

## ğŸ¯ å…³é”®è®¾è®¡å†³ç­–

### å†³ç­– 1ï¼šä¸ºä»€ä¹ˆé€‰æ‹© JSON Schema è€Œé Protocol Buffersï¼Ÿ

**è€ƒè™‘å› ç´ **ï¼š
- âœ… **äººç±»å¯è¯»æ€§**ï¼šJSON æ˜“äºé˜…è¯»å’Œè°ƒè¯•
- âœ… **å‰ç«¯åŸç”Ÿæ”¯æŒ**ï¼šJavaScript å¤©ç„¶æ”¯æŒ JSON
- âœ… **Schema éªŒè¯æˆç†Ÿ**ï¼šjsonschema åº“åŠŸèƒ½å®Œå–„
- âœ… **ç‰ˆæœ¬æ¼”è¿›çµæ´»**ï¼šæ˜“äºæ‰©å±•å’Œå‘åå…¼å®¹
- âŒ **æ€§èƒ½è¾ƒä½**ï¼šä½†å¯¹äºåˆ†æç»“æœæ–‡ä»¶å¯æ¥å—

**ç»“è®º**ï¼šé€‰æ‹© JSON Schema

### å†³ç­– 2ï¼šä¸ºä»€ä¹ˆå‰ç«¯ä¸éœ€è¦åç«¯æœåŠ¡å™¨ï¼Ÿ

**è€ƒè™‘å› ç´ **ï¼š
- âœ… **é™ä½éƒ¨ç½²å¤æ‚åº¦**ï¼šçº¯é™æ€åº”ç”¨
- âœ… **æé«˜å“åº”é€Ÿåº¦**ï¼šæœ¬åœ°åŠ è½½ JSON æ–‡ä»¶
- âœ… **é™ä½è¿ç»´æˆæœ¬**ï¼šæ— éœ€ç»´æŠ¤æœåŠ¡å™¨
- âœ… **éšç§ä¿æŠ¤**ï¼šåˆ†ææ•°æ®ä¸ç»è¿‡æœåŠ¡å™¨
- âŒ **æ— æ³•å®æ—¶åˆ†æ**ï¼šéœ€è¦å…ˆç”Ÿæˆ JSON

**ç»“è®º**ï¼šé‡‡ç”¨çº¯é™æ€å‰ç«¯ + æœ¬åœ° JSON æ–‡ä»¶æ–¹æ¡ˆ

### å†³ç­– 3ï¼šä¸ºä»€ä¹ˆä½¿ç”¨ Cytoscape.js è€Œé D3.js ä½œä¸ºä¸»å¼•æ“ï¼Ÿ

**å¯¹æ¯”åˆ†æ**ï¼š

| ç‰¹æ€§ | Cytoscape.js | D3.js |
|------|--------------|-------|
| å›¾å½¢æ¸²æŸ“æ€§èƒ½ | â­â­â­â­â­ ä¸“é—¨ä¼˜åŒ– | â­â­â­ é€šç”¨åº“ |
| å±‚çº§å¸ƒå±€ | â­â­â­â­â­ å†…ç½®å¤šç§ç®—æ³• | â­â­â­ éœ€è¦æ‰‹åŠ¨å®ç° |
| èŠ‚ç‚¹äº¤äº’ | â­â­â­â­â­ ä¸°å¯Œçš„äº‹ä»¶ç³»ç»Ÿ | â­â­â­â­ çµæ´»ä½†éœ€ç¼–ç  |
| åŠ¨ç”»æ”¯æŒ | â­â­â­â­ å†…ç½®åŠ¨ç”»å¼•æ“ | â­â­â­â­â­ æœ€å¼ºå¤§ |
| å­¦ä¹ æ›²çº¿ | â­â­â­â­ è¾ƒå¹³ç¼“ | â­â­ è¾ƒé™¡å³­ |

**ç»“è®º**ï¼š
- **ä¸»å¼•æ“**ï¼šCytoscape.jsï¼ˆä»£ç ç»“æ„å›¾ + å¤šæµç¨‹åŠ¨ç”»ï¼‰
- **è¾…åŠ©å¼•æ“**ï¼šD3.jsï¼ˆæ—¶åºå›¾/æµç¨‹å›¾/å˜é‡è¿½è¸ªï¼‰

### å†³ç­– 4ï¼šä¸ºä»€ä¹ˆä½¿ç”¨ TypedDict è€Œé Pydantic dataclassï¼Ÿ

**å¯¹æ¯”åˆ†æ**ï¼š

```python
# TypedDictï¼ˆé€‰æ‹©æ–¹æ¡ˆï¼‰
class CodeNode(TypedDict):
    id: str
    label: str
    stereotype: Literal["system", "module", "class"]

# ä¼˜ç‚¹ï¼š
# - çº¯ç±»å‹æç¤ºï¼Œé›¶è¿è¡Œæ—¶å¼€é”€
# - ä¸ JSON æ•°æ®ç»“æ„å®Œç¾å¯¹åº”
# - mypy ç±»å‹æ£€æŸ¥æ”¯æŒ

# Pydanticï¼ˆæœªé€‰æ‹©ï¼‰
class CodeNode(BaseModel):
    id: str
    label: str
    stereotype: Literal["system", "module", "class"]

# ç¼ºç‚¹ï¼š
# - è¿è¡Œæ—¶éªŒè¯æœ‰æ€§èƒ½å¼€é”€
# - å¯¹è±¡å®ä¾‹åŒ–æˆæœ¬é«˜
# - ä¸å¦‚ jsonschema éªŒè¯çµæ´»
```

**ç»“è®º**ï¼šTypedDict + jsonschema éªŒè¯

### å†³ç­– 5ï¼šä¸ºä»€ä¹ˆ Prompt æ¨¡æ¿ä½¿ç”¨ Jinja2 è€Œé Python f-stringï¼Ÿ

**è€ƒè™‘å› ç´ **ï¼š
- âœ… **é€»è¾‘ä¸æ•°æ®åˆ†ç¦»**ï¼šæ¨¡æ¿æ˜¯ç‹¬ç«‹æ–‡ä»¶
- âœ… **ç‰ˆæœ¬ç®¡ç†**ï¼šYAML æ–‡ä»¶æ˜“äºç‰ˆæœ¬æ§åˆ¶
- âœ… **æ¡ä»¶å’Œå¾ªç¯**ï¼šJinja2 æ”¯æŒå¤æ‚é€»è¾‘
- âœ… **è‡ªå®šä¹‰è¿‡æ»¤å™¨**ï¼šæ‰©å±•æ€§å¼º
- âœ… **å¤šè¯­è¨€æ”¯æŒ**ï¼šä¸€ä»½æ¨¡æ¿æ”¯æŒå¤šç§åœºæ™¯

**ç»“è®º**ï¼šJinja2 æ¨¡æ¿å¼•æ“

---

## ğŸ”§ æŠ€æœ¯é€‰å‹ç†ç”±

### åç«¯æŠ€æœ¯æ ˆ

#### Python 3.11+
**ç†ç”±**ï¼š
- ç±»å‹æç¤ºæˆç†Ÿï¼ˆTypedDict, Literal, NotRequiredï¼‰
- å¼‚æ­¥ç¼–ç¨‹æ”¯æŒå®Œå–„ï¼ˆasyncioï¼‰
- AI SDK ç”Ÿæ€ä¸°å¯Œ
- æ•°æ®å¤„ç†åº“å¼ºå¤§

#### Jinja2
**ç†ç”±**ï¼š
- Django/Flask åŒæ¬¾æ¨¡æ¿å¼•æ“ï¼Œæˆç†Ÿç¨³å®š
- è¯­æ³•ç®€æ´ï¼Œå­¦ä¹ æˆæœ¬ä½
- æ‰©å±•æ€§å¼ºï¼Œæ”¯æŒè‡ªå®šä¹‰è¿‡æ»¤å™¨
- æ€§èƒ½ä¼˜ç§€

#### jsonschema
**ç†ç”±**ï¼š
- JSON Schema æ ‡å‡†å®ç°
- éªŒè¯è§„åˆ™è¡¨è¾¾åŠ›å¼º
- é”™è¯¯æç¤ºè¯¦ç»†
- ç¤¾åŒºæ´»è·ƒ

#### Anthropic SDK
**ç†ç”±**ï¼š
- Claude 4.5 æ¨ç†èƒ½åŠ›å¼º
- é•¿ä¸Šä¸‹æ–‡æ”¯æŒï¼ˆ200K tokensï¼‰
- API ç¨³å®šå¯é 
- æ–‡æ¡£å®Œå–„

### å‰ç«¯æŠ€æœ¯æ ˆ

#### React 18
**ç†ç”±**ï¼š
- å¹¶å‘æ¸²æŸ“ï¼ˆConcurrent Renderingï¼‰
- è‡ªåŠ¨æ‰¹å¤„ç†ï¼ˆAutomatic Batchingï¼‰
- Suspense æ”¯æŒ
- ç”Ÿæ€æˆç†Ÿ

#### TypeScript 5.x
**ç†ç”±**ï¼š
- ç±»å‹å®‰å…¨
- IDE æ”¯æŒå®Œå–„
- é‡æ„å‹å¥½
- ä¸åç«¯ TypedDict å¯¹åº”

#### Zustand
**ç†ç”±**ï¼š
- è½»é‡çº§ï¼ˆ~1KBï¼‰
- æ— éœ€ Provider åŒ…è£¹
- æ”¯æŒä¸­é—´ä»¶
- TypeScript æ”¯æŒå¥½

#### Cytoscape.js
**ç†ç”±**ï¼š
- å›¾å½¢æ¸²æŸ“æ€§èƒ½æœ€ä¼˜
- å±‚çº§å¸ƒå±€ç®—æ³•ä¸°å¯Œ
- äº¤äº’äº‹ä»¶ç³»ç»Ÿå®Œå–„
- æ´»è·ƒç¤¾åŒºæ”¯æŒ

#### D3.js
**ç†ç”±**ï¼š
- æ•°æ®å¯è§†åŒ–æ ‡å‡†
- åŠ¨ç”»èƒ½åŠ›æœ€å¼º
- è‡ªå®šä¹‰èƒ½åŠ›æœ€é«˜
- å¤§é‡ç¤ºä¾‹

#### Monaco Editor
**ç†ç”±**ï¼š
- VS Code åŒæ¬¾ç¼–è¾‘å™¨
- ä»£ç é«˜äº®æœ€å‡†ç¡®
- æ”¯æŒæ‰€æœ‰ä¸»æµè¯­è¨€
- æ€§èƒ½ä¼˜ç§€

#### Vite
**ç†ç”±**ï¼š
- å¼€å‘æ¨¡å¼æå¿«
- ç”Ÿäº§æ„å»ºä¼˜åŒ–
- æ’ä»¶ç”Ÿæ€å®Œå–„
- TypeScript åŸç”Ÿæ”¯æŒ

---

## ğŸš€ æ‰©å±•æ€§è®¾è®¡

### 1. æ–°è¯­è¨€æ”¯æŒ

**æ‰©å±•æ­¥éª¤**ï¼š
1. åœ¨ `backend/prompts/<language>/` åˆ›å»ºç›®å½•
2. ä¸º 5 ä¸ªé˜¶æ®µåˆ›å»º Prompt æ¨¡æ¿
3. åœ¨ `registry.yaml` æ³¨å†Œæ¨¡æ¿
4. æµ‹è¯•å¹¶ä¼˜åŒ–æ¨¡æ¿

**é›¶ä»£ç æ”¹åŠ¨**ï¼šæ¶æ„å¤©ç„¶æ”¯æŒæ–°è¯­è¨€

### 2. æ–° AI é€‚é…å™¨

**æ‰©å±•æ­¥éª¤**ï¼š
1. ç»§æ‰¿ `BaseAIAdapter`
2. å®ç° 4 ä¸ªæŠ½è±¡æ–¹æ³•ï¼š
   - `generate()`
   - `generate_stream()`
   - `validate_connection()`
   - `get_model_info()`
3. åˆ›å»ºå·¥å‚å‡½æ•° `create_xxx_adapter()`

**ç¤ºä¾‹**ï¼š

```python
class DeepSeekAdapter(BaseAIAdapter):
    async def generate(self, prompt, **kwargs) -> AIResponse:
        # DeepSeek API è°ƒç”¨é€»è¾‘
        pass
```

### 3. æ•°æ®åè®®æ¼”è¿›

**ç‰ˆæœ¬ç®¡ç†ç­–ç•¥**ï¼š
- é‡‡ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆSemantic Versioningï¼‰
- v1.x.x â†’ å‘åå…¼å®¹çš„æ‰©å±•
- v2.x.x â†’ ä¸å…¼å®¹çš„é‡å¤§å˜æ›´

**æ‰©å±•æœºåˆ¶**ï¼š
- ä½¿ç”¨ `$schema` å­—æ®µæ ‡è¯†ç‰ˆæœ¬
- æ—§ç‰ˆæœ¬æ•°æ®è‡ªåŠ¨è¿ç§»åˆ°æ–°ç‰ˆæœ¬
- éªŒè¯å™¨æ”¯æŒå¤šç‰ˆæœ¬å¹¶å­˜

### 4. æ–°å¯è§†åŒ–è§†å›¾

**æ‰©å±•æ­¥éª¤**ï¼š
1. åœ¨ `frontend/src/components/` åˆ›å»ºæ–°ç»„ä»¶
2. ä» `analysisStore` è¯»å–æ•°æ®
3. ä½¿ç”¨ D3.js æˆ–å…¶ä»–åº“æ¸²æŸ“
4. åœ¨ä¸»ç•Œé¢æ·»åŠ åˆ‡æ¢æŒ‰é’®

**ç¤ºä¾‹è§†å›¾**ï¼š
- ä¾èµ–å…³ç³»çŸ©é˜µ
- å¤æ‚åº¦çƒ­åŠ›å›¾
- è°ƒç”¨é“¾ç€‘å¸ƒå›¾
- æ€§èƒ½ç“¶é¢ˆç«ç„°å›¾

---

## âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. Prompt æ¨¡æ¿ç¼“å­˜

```python
class PromptTemplateManager:
    def __init__(self):
        self._cache: Dict[str, PromptTemplate] = {}

    def load_template(self, language, stage, version=None):
        cache_key = f"{language}:{stage}:{version or 'latest'}"
        if cache_key in self._cache:
            return self._cache[cache_key]
        # åŠ è½½æ¨¡æ¿
        template = self._load_from_file(...)
        self._cache[cache_key] = template
        return template
```

### 2. AI é€‚é…å™¨è¿æ¥æ± 

```python
class ClaudeAdapter(BaseAIAdapter):
    def __init__(self):
        self.client = AsyncAnthropic(
            max_retries=3,
            timeout=60.0,
            connection_pool_maxsize=10  # è¿æ¥æ± 
        )
```

### 3. å‰ç«¯è™šæ‹ŸåŒ–æ¸²æŸ“

**å¤§è§„æ¨¡èŠ‚ç‚¹æ¸²æŸ“ä¼˜åŒ–**ï¼š

```typescript
// Cytoscape.js è§†å£å‰”é™¤
const cy = cytoscape({
  container: document.getElementById('cy'),
  renderer: {
    hideEdgesOnViewport: true,  // è§†å£å¤–éšè—è¾¹
    hideLabelsOnViewport: true, // è§†å£å¤–éšè—æ ‡ç­¾
    textureOnViewport: true     // çº¹ç†ä¼˜åŒ–
  }
});
```

### 4. JSON å‹ç¼©å­˜å‚¨

```python
class ProtocolSerializer:
    def serialize(self, data, output_path, compress=True):
        json_str = json.dumps(data, ensure_ascii=False, indent=2)
        if compress:
            # gzip å‹ç¼©ï¼Œå‡å°‘ 70% æ–‡ä»¶å¤§å°
            with gzip.open(f"{output_path}.gz", 'wt') as f:
                f.write(json_str)
        else:
            with open(output_path, 'w') as f:
                f.write(json_str)
```

### 5. åŠ¨ç”»æ€§èƒ½ä¼˜åŒ–

**å¸§ç‡æ§åˆ¶**ï¼š

```typescript
class AnimationController {
  private fps = 60;
  private frameInterval = 1000 / this.fps;
  private lastFrameTime = 0;

  animate(timestamp: number) {
    if (timestamp - this.lastFrameTime < this.frameInterval) {
      requestAnimationFrame(this.animate.bind(this));
      return;
    }

    // æ‰§è¡ŒåŠ¨ç”»é€»è¾‘
    this.updateFrame();

    this.lastFrameTime = timestamp;
    requestAnimationFrame(this.animate.bind(this));
  }
}
```

### 6. Web Worker å¼‚æ­¥å¤„ç†

**å¤§æ•°æ®å¤„ç†ä¼˜åŒ–**ï¼š

```typescript
// åœ¨ Web Worker ä¸­è§£æå’ŒéªŒè¯ JSON
const worker = new Worker('json-parser-worker.js');

worker.postMessage({ jsonData: largeJsonString });

worker.onmessage = (event) => {
  const parsedData: AnalysisResult = event.data;
  // æ›´æ–° UI
};
```

---

## ğŸ“– å‚è€ƒèµ„æ–™

- [JSON Schema Specification](https://json-schema.org/)
- [Cytoscape.js Documentation](https://js.cytoscape.org/)
- [D3.js Documentation](https://d3js.org/)
- [Anthropic Claude API](https://docs.anthropic.com/)
- [Model Context Protocol](https://modelcontextprotocol.io/)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
**æœ€åæ›´æ–°**: 2025-01-12
**ç»´æŠ¤è€…**: AIFlow Team
