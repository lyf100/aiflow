# AIFlow æ ¸å¿ƒæŒ‡ä»¤é›†è®¾è®¡æ–‡æ¡£

**Prompt Library Design Document for AIFlow**

---

## ğŸ“‹ ç›®å½•

1. [æŒ‡ä»¤é›†æ¦‚è¿°](#æŒ‡ä»¤é›†æ¦‚è¿°)
2. [è®¾è®¡åŸåˆ™](#è®¾è®¡åŸåˆ™)
3. [äº”é˜¶æ®µåˆ†ææµç¨‹](#äº”é˜¶æ®µåˆ†ææµç¨‹)
4. [Prompt æ¨¡æ¿ç»“æ„](#prompt-æ¨¡æ¿ç»“æ„)
5. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
6. [ç¤ºä¾‹æ¨¡æ¿](#ç¤ºä¾‹æ¨¡æ¿)
7. [ä¼˜åŒ–æŠ€å·§](#ä¼˜åŒ–æŠ€å·§)

---

## ğŸ¯ æŒ‡ä»¤é›†æ¦‚è¿°

AIFlow çš„æ ¸å¿ƒæŒ‡ä»¤é›†ï¼ˆPrompt Libraryï¼‰æ˜¯æ•´ä¸ªå¹³å°çš„"å¤§è„‘"ã€‚å®ƒé€šè¿‡ç²¾å¿ƒè®¾è®¡çš„æŒ‡ä»¤æ¨¡æ¿ï¼ŒæŒ‡æŒ¥ AI å·¥å…·å®Œæˆä»£ç åˆ†æçš„æ‰€æœ‰å·¥ä½œã€‚

### æ ¸å¿ƒä½¿å‘½

1. **æ™ºèƒ½å§”æ‰˜**ï¼šå¹³å°ä¸è§£æä»£ç ï¼Œè€Œæ˜¯é€šè¿‡æŒ‡ä»¤è®© AI å®Œæˆæ‰€æœ‰åˆ†æ
2. **è¯­ä¹‰ç†è§£**ï¼šAI è´Ÿè´£æ¨¡å—åˆ’åˆ†ã€åŠŸèƒ½å‘½åç­‰éœ€è¦ä¸šåŠ¡ç†è§£çš„ä»»åŠ¡
3. **æ ‡å‡†è¾“å‡º**ï¼šæ‰€æœ‰ AI åˆ†æç»“æœå¿…é¡»ç¬¦åˆæ ‡å‡†æ•°æ®åè®®ï¼ˆJSON Schema v1.0.0ï¼‰

### è®¾è®¡å“²å­¦

```
ä¼ ç»Ÿæ–¹å¼ï¼š
  ä»£ç  â†’ ASTè§£æå™¨ â†’ é™æ€åˆ†æ â†’ æœºæ¢°åŒ–è¾“å‡º

AIFlow æ–¹å¼ï¼š
  ä»£ç  + Prompt â†’ AIç†è§£ â†’ è¯­ä¹‰åŒ–è¾“å‡º
```

**å…³é”®å·®å¼‚**ï¼š
- âŒ ä¼ ç»Ÿï¼šæŠ€æœ¯åç§°ï¼ˆ`UserController.createUser()`ï¼‰
- âœ… AIFlowï¼šä¸šåŠ¡è¯­ä¹‰ï¼ˆ`ç”¨æˆ·æ³¨å†Œæµç¨‹`ï¼‰

---

## ğŸ—ï¸ è®¾è®¡åŸåˆ™

### 1. æ¸è¿›å¼å¼•å¯¼ï¼ˆProgressive Guidanceï¼‰

**åŸåˆ™**ï¼šä»å®è§‚åˆ°å¾®è§‚ï¼Œé€æ­¥æ·±å…¥åˆ†æã€‚

```yaml
é˜¶æ®µåˆ’åˆ†ï¼š
  Stage 1 (é¡¹ç›®è®¤çŸ¥): å…ˆç†è§£æ•´ä½“
  Stage 2 (ç»“æ„è¯†åˆ«): å†è¯†åˆ«å±‚æ¬¡
  Stage 3 (è¯­ä¹‰åˆ†æ): ç„¶åç†è§£è¯­ä¹‰
  Stage 4 (æ‰§è¡Œæ¨ç†): æ¥ç€æ¨æ–­è¡Œä¸º
  Stage 5 (å¹¶å‘æ£€æµ‹): æœ€ååˆ†æå¹¶å‘
```

**ä¸ºä»€ä¹ˆ**ï¼š
- AI éœ€è¦ä¸Šä¸‹æ–‡æ‰èƒ½åšå‡ºå‡†ç¡®æ¨æ–­
- å…ˆå®è§‚åå¾®è§‚ï¼Œç¬¦åˆäººç±»è®¤çŸ¥è§„å¾‹
- æ¯ä¸ªé˜¶æ®µè¾“å‡ºä¸ºä¸‹ä¸€é˜¶æ®µæä¾›è¾“å…¥

### 2. æ˜ç¡®æ€§ä¼˜å…ˆï¼ˆExplicit Over Implicitï¼‰

**åŸåˆ™**ï¼šæŒ‡ä»¤å¿…é¡»æ˜ç¡®ã€å…·ä½“ã€æ— æ­§ä¹‰ã€‚

```yaml
âŒ å·®çš„æŒ‡ä»¤:
  "åˆ†æè¿™ä¸ªé¡¹ç›®çš„ä»£ç ç»“æ„"
  # é—®é¢˜: ä»€ä¹ˆå«"ç»“æ„"ï¼Ÿè¾“å‡ºä»€ä¹ˆæ ¼å¼ï¼Ÿ

âœ… å¥½çš„æŒ‡ä»¤:
  "è¯†åˆ«é¡¹ç›®ä¸­çš„æ‰€æœ‰æ¨¡å—ã€ç±»ã€å‡½æ•°ï¼Œå¹¶ç”Ÿæˆä»¥ä¸‹JSONæ ¼å¼ï¼š
   {
     "nodes": [...],
     "edges": [...]
   }
   å…¶ä¸­æ¯ä¸ªèŠ‚ç‚¹å¿…é¡»åŒ…å«idã€labelã€stereotypeã€parentç­‰å­—æ®µ"
```

### 3. ç¤ºä¾‹é©±åŠ¨ï¼ˆExample-Drivenï¼‰

**åŸåˆ™**ï¼šæä¾›å®Œæ•´çš„è¾“å…¥è¾“å‡ºç¤ºä¾‹ã€‚

```yaml
æŒ‡ä»¤ä¸­å¿…é¡»åŒ…å«:
  1. è¾“å…¥ç¤ºä¾‹ï¼ˆä»£ç ç‰‡æ®µï¼‰
  2. æœŸæœ›è¾“å‡ºï¼ˆJSONç¤ºä¾‹ï¼‰
  3. è¾¹ç•Œæƒ…å†µå¤„ç†ï¼ˆå¼‚å¸¸ç¤ºä¾‹ï¼‰
```

**ä¸ºä»€ä¹ˆ**ï¼š
- AI é€šè¿‡ç¤ºä¾‹å­¦ä¹ æ¯”é€šè¿‡æè¿°å­¦ä¹ æ›´å‡†ç¡®
- å‡å°‘è¾“å‡ºæ ¼å¼çš„ä¸ç¡®å®šæ€§
- é™ä½ AI "åˆ›é€ æ€§å‘æŒ¥"çš„é£é™©

### 4. çº¦æŸé©±åŠ¨ï¼ˆConstraint-Drivenï¼‰

**åŸåˆ™**ï¼šæ˜ç¡®å‘ŠçŸ¥ AI ä¸èƒ½åšä»€ä¹ˆã€‚

```yaml
å¿…é¡»åŒ…å«çš„çº¦æŸ:
  - UUID å¿…é¡»æ˜¯ v4 æ ¼å¼
  - æ—¶é—´æˆ³å¿…é¡»æ˜¯ ISO 8601 æ ¼å¼
  - execution_order å¿…é¡»å…¨å±€å”¯ä¸€é€’å¢
  - èŠ‚ç‚¹IDå¿…é¡»åœ¨edgesä¸­å¼•ç”¨æ—¶å­˜åœ¨
  - ä¸è¦ç¼–é€ ä¸å­˜åœ¨çš„ä»£ç 
```

### 5. ä¸šåŠ¡è¯­ä¹‰åŒ–ï¼ˆBusiness Semanticsï¼‰

**åŸåˆ™**ï¼šä¼˜å…ˆä½¿ç”¨ä¸šåŠ¡è¯­è¨€è€ŒéæŠ€æœ¯æœ¯è¯­ã€‚

```yaml
âŒ æŠ€æœ¯åŒ–å‘½å:
  èŠ‚ç‚¹åç§°: "UserController"
  æŒ‰é’®åç§°: "createUser()"

âœ… ä¸šåŠ¡è¯­ä¹‰åŒ–:
  èŠ‚ç‚¹åç§°: "ç”¨æˆ·ç®¡ç†æ¨¡å—"
  æŒ‰é’®åç§°: "åˆ›å»ºæ–°ç”¨æˆ·"
```

**ä¸ºä»€ä¹ˆ**ï¼š
- ä¸šåŠ¡äººå‘˜ä¹Ÿèƒ½ç†è§£å¯è§†åŒ–ç»“æœ
- æ›´ç¬¦åˆ"è¡Œä¸ºæ²™ç›˜"çš„å®šä½
- AI æ“…é•¿ç†è§£ä¸šåŠ¡è¯­ä¹‰

### 6. å¯éªŒè¯æ€§ï¼ˆVerifiabilityï¼‰

**åŸåˆ™**ï¼šAI è¾“å‡ºå¿…é¡»å¯éªŒè¯ã€‚

```yaml
éªŒè¯æœºåˆ¶:
  1. JSON Schema æ ¼å¼éªŒè¯
  2. å¼•ç”¨å®Œæ•´æ€§éªŒè¯
  3. ä¸šåŠ¡è§„åˆ™éªŒè¯
  4. AI å¿…é¡»æä¾› confidence åˆ†æ•°
```

---

## ğŸ“Š äº”é˜¶æ®µåˆ†ææµç¨‹

### Stage 1: é¡¹ç›®è®¤çŸ¥ï¼ˆProject Understandingï¼‰

**ç›®æ ‡**ï¼šç†è§£é¡¹ç›®çš„æ•´ä½“ç‰¹å¾å’ŒæŠ€æœ¯èƒŒæ™¯ã€‚

**è¾“å…¥æ•°æ®**ï¼š
```yaml
- project_path: é¡¹ç›®æ ¹ç›®å½•
- project_name: é¡¹ç›®åç§°
- file_tree: æ–‡ä»¶æ ‘ç»“æ„
- main_files: ä¸»è¦æ–‡ä»¶åˆ—è¡¨ï¼ˆREADME, package.jsonç­‰ï¼‰
```

**åˆ†æä»»åŠ¡**ï¼š
1. è¯†åˆ«ä¸»è¦ç¼–ç¨‹è¯­è¨€
2. æ£€æµ‹ä½¿ç”¨çš„æ¡†æ¶å’Œåº“
3. æ¨æ–­æ¶æ„æ¨¡å¼ï¼ˆMVC, å¾®æœåŠ¡, åˆ†å±‚æ¶æ„ç­‰ï¼‰
4. è¯†åˆ«å…¥å£æ–‡ä»¶
5. è¯„ä¼°é¡¹ç›®å¤æ‚åº¦

**è¾“å‡ºæ ¼å¼**ï¼š
```json
{
  "project_metadata": {
    "name": "string",
    "language": "string",
    "version": "string",
    "description": "AIç”Ÿæˆçš„é¡¹ç›®æè¿°",
    "framework": ["string"],
    "architecture_pattern": ["string"],
    "entry_points": ["string"],
    "dependencies": ["string"],
    "complexity_score": 0.0
  }
}
```

**å…³é”®æŒ‡ä»¤è¦ç‚¹**ï¼š
```yaml
æ˜ç¡®è¦æ±‚:
  - åŸºäº README.md å’Œ package.json è¿›è¡Œæ¨ç†
  - å¦‚æœ README ä¸å¯é ï¼Œæ ‡æ³¨ "readme_reliability": "ä¸å¯é "
  - å¿…é¡»ç»™å‡º complexity_score (0-1)
  - å¿…é¡»ç”¨ä¸­æ–‡ç”Ÿæˆ descriptionï¼ˆä¸šåŠ¡è¯­ä¹‰åŒ–ï¼‰
```

### Stage 2: ç»“æ„è¯†åˆ«ï¼ˆStructure Recognitionï¼‰

**ç›®æ ‡**ï¼šè¯†åˆ«ä»£ç çš„å±‚çº§ç»“æ„å’Œä¾èµ–å…³ç³»ã€‚

**è¾“å…¥æ•°æ®**ï¼š
```yaml
- project_metadata: Stage 1 è¾“å‡º
- source_files: æºä»£ç æ–‡ä»¶åˆ—è¡¨
- file_contents: éƒ¨åˆ†æ–‡ä»¶å†…å®¹
```

**åˆ†æä»»åŠ¡**ï¼š
1. è¯†åˆ«ç³»ç»Ÿçº§æ¨¡å—åˆ’åˆ†
2. è¯†åˆ«æ¯ä¸ªæ¨¡å—å†…çš„ç±»å’Œå‡½æ•°
3. å»ºç«‹çˆ¶å­å±‚çº§å…³ç³»
4. è¯†åˆ«æ¨¡å—é—´çš„ä¾èµ–å…³ç³»ï¼ˆimports, callsï¼‰
5. ä¸ºæ¯ä¸ªèŠ‚ç‚¹ç”Ÿæˆä¸šåŠ¡è¯­ä¹‰åŒ–çš„åç§°

**è¾“å‡ºæ ¼å¼**ï¼š
```json
{
  "code_structure": {
    "nodes": [
      {
        "id": "uuid-v4",
        "label": "ç”¨æˆ·è®¤è¯æ¨¡å—",
        "stereotype": "module",
        "parent": null,
        "file_path": "src/auth/index.js",
        "line_range": [1, 150],
        "metadata": {
          "visibility": "public",
          "is_async": false,
          "is_exported": true,
          "ai_confidence": 0.95
        }
      }
    ],
    "edges": [
      {
        "id": "uuid-v4",
        "source": "node-id-1",
        "target": "node-id-2",
        "relationship": "imports",
        "label": "å¯¼å…¥ç”¨æˆ·æ¨¡å‹",
        "weight": 0.8
      }
    ]
  }
}
```

**å…³é”®æŒ‡ä»¤è¦ç‚¹**ï¼š
```yaml
æ˜ç¡®è¦æ±‚:
  - label å¿…é¡»æ˜¯ä¸šåŠ¡è¯­ä¹‰åŒ–çš„ä¸­æ–‡åç§°
  - stereotype å¿…é¡»æ˜¯: system | module | class | function | service | component
  - parent å­—æ®µå»ºç«‹å±‚çº§å…³ç³»
  - æ‰€æœ‰ edge.source å’Œ edge.target å¿…é¡»æŒ‡å‘å­˜åœ¨çš„èŠ‚ç‚¹ID
  - relationship å¿…é¡»æ˜¯: imports | calls | extends | implements | contains | depends_on
```

### Stage 3: è¯­ä¹‰åˆ†æï¼ˆSemantic Analysisï¼‰

**ç›®æ ‡**ï¼šç†è§£ä»£ç çš„ä¸šåŠ¡è¯­ä¹‰ï¼Œç”Ÿæˆå¯åŠ¨æŒ‰é’®ã€‚

**è¾“å…¥æ•°æ®**ï¼š
```yaml
- project_metadata: Stage 1 è¾“å‡º
- code_structure: Stage 2 è¾“å‡º
- source_files: æºä»£ç æ–‡ä»¶
```

**åˆ†æä»»åŠ¡**ï¼š
1. è¯†åˆ«å…·æœ‰ç‹¬ç«‹ä¸šåŠ¡æ„ä¹‰çš„åŠŸèƒ½å•å…ƒ
2. ä¸ºæ¯ä¸ªåŠŸèƒ½å•å…ƒç”Ÿæˆ"å¯åŠ¨æŒ‰é’®"
3. å»ºç«‹æŒ‰é’®çš„åµŒå¥—å…³ç³»ï¼ˆå¤§æŒ‰é’® â†’ å°æŒ‰é’®ï¼‰
4. æ¨æ–­æŒ‰é’®çš„ç±»å‹ï¼ˆmacro/microï¼‰å’Œå±‚çº§

**è¾“å‡ºæ ¼å¼**ï¼š
```json
{
  "behavior_metadata": {
    "launch_buttons": [
      {
        "id": "uuid-v4",
        "node_id": "å…³è”çš„ä»£ç èŠ‚ç‚¹ID",
        "name": "å¯åŠ¨ç”¨æˆ·æ³¨å†Œæµç¨‹",
        "description": "å®Œæ•´çš„ç”¨æˆ·æ³¨å†Œä¸šåŠ¡æµç¨‹ï¼ŒåŒ…æ‹¬é‚®ç®±éªŒè¯å’Œæ•°æ®ä¿å­˜",
        "type": "macro",
        "level": "system",
        "icon": "user-plus",
        "parent_button_id": null,
        "child_button_ids": ["å­æŒ‰é’®ID1", "å­æŒ‰é’®ID2"],
        "traceable_unit_id": "å…³è”çš„æ‰§è¡Œè½¨è¿¹ID",
        "metadata": {
          "ai_confidence": 0.90,
          "ai_explanation": "åŸºäºå‡½æ•°åå’Œä¸šåŠ¡é€»è¾‘æ¨ç†",
          "estimated_duration": 5000,
          "requires_input": true,
          "has_side_effects": true
        }
      }
    ],
    "functional_units": [
      {
        "id": "uuid-v4",
        "name": "ç”¨æˆ·æ³¨å†Œå•å…ƒ",
        "type": "business_process",
        "node_ids": ["å…³è”èŠ‚ç‚¹IDåˆ—è¡¨"],
        "input_data": ["email", "password"],
        "output_data": ["user_id", "token"],
        "dependencies": ["æ•°æ®åº“æœåŠ¡", "é‚®ä»¶æœåŠ¡"]
      }
    ]
  }
}
```

**å…³é”®æŒ‡ä»¤è¦ç‚¹**ï¼š
```yaml
æ˜ç¡®è¦æ±‚:
  - name å¿…é¡»æ˜¯ä¸šåŠ¡è¯­ä¹‰åŒ–çš„ä¸­æ–‡åç§°ï¼ˆä¸æ˜¯æŠ€æœ¯å‡½æ•°åï¼‰
  - type åˆ†ä¸º macroï¼ˆç³»ç»Ÿçº§ï¼‰å’Œ microï¼ˆæ¨¡å—çº§ï¼‰
  - level åˆ†ä¸º system | module | component | function
  - parent_button_id å»ºç«‹åµŒå¥—å…³ç³»ï¼š
    * é¡¶å±‚æŒ‰é’®: parent_button_id = null
    * å­æŒ‰é’®: parent_button_id = çˆ¶æŒ‰é’®ID
  - å¿…é¡»æä¾› ai_explanation è¯´æ˜æ¨ç†ä¾æ®
  - estimated_duration å•ä½ä¸ºæ¯«ç§’
```

### Stage 4: æ‰§è¡Œæ¨ç†ï¼ˆExecution Inferenceï¼‰

**ç›®æ ‡**ï¼šæ¨æ–­ä»£ç çš„æ‰§è¡Œè·¯å¾„å’Œè°ƒç”¨å…³ç³»ã€‚

**è¾“å…¥æ•°æ®**ï¼š
```yaml
- project_metadata: Stage 1 è¾“å‡º
- code_structure: Stage 2 è¾“å‡º
- behavior_metadata: Stage 3 è¾“å‡º
- source_files: æºä»£ç æ–‡ä»¶
```

**åˆ†æä»»åŠ¡**ï¼š
1. è¯†åˆ« 3-5 ä¸ªæ ¸å¿ƒä¸šåŠ¡åœºæ™¯
2. ä¸ºæ¯ä¸ªåœºæ™¯æ¨æ–­æ‰§è¡Œè·¯å¾„
3. ç”Ÿæˆä¸‰ç§æ ¼å¼çš„æ‰§è¡Œè½¨è¿¹ï¼š
   - flowchartï¼ˆæµç¨‹å›¾ï¼‰
   - sequenceï¼ˆæ—¶åºå›¾ï¼‰
   - step-by-stepï¼ˆå•æ­¥æ‰§è¡Œï¼‰
4. æ¨æ–­å˜é‡ä½œç”¨åŸŸå’Œè°ƒç”¨å †æ ˆ

**è¾“å‡ºæ ¼å¼**ï¼š
```json
{
  "execution_trace": {
    "traceable_units": [
      {
        "id": "uuid-v4",
        "name": "ç”¨æˆ·ç™»å½•æµç¨‹",
        "type": "i-trace",
        "sub_unit_ids": [],
        "level": "system",
        "traces": [
          {
            "format": "flowchart",
            "data": {
              "steps": [
                {
                  "id": "step-uuid",
                  "label": "éªŒè¯ç”¨æˆ·è¾“å…¥",
                  "type": "process"
                },
                {
                  "id": "fork-uuid",
                  "label": "å¹¶å‘æ£€æŸ¥",
                  "type": "fork"
                }
              ],
              "connections": [...]
            }
          },
          {
            "format": "sequence",
            "data": {
              "lifelines": [...],
              "messages": [...]
            }
          },
          {
            "format": "step-by-step",
            "data": {
              "steps": [...],
              "variableScopes": [...],
              "callStack": [...]
            }
          }
        ]
      }
    ]
  }
}
```

**å…³é”®æŒ‡ä»¤è¦ç‚¹**ï¼š
```yaml
æ˜ç¡®è¦æ±‚:
  - å¿…é¡»ç”Ÿæˆ 3 ç§æ ¼å¼çš„ traceï¼ˆflowchart, sequence, step-by-stepï¼‰
  - flowchart çš„ type å¿…é¡»æ”¯æŒ: start | end | process | decision | fork | join
  - sequence çš„ timestamp æ˜¯ç›¸å¯¹æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
  - step-by-step çš„ execution_order å¿…é¡»å…¨å±€å”¯ä¸€é€’å¢
  - variableScopes çš„ scope_type å¿…é¡»æ˜¯: global | local | closure
  - callStack è®°å½•å‡½æ•°è°ƒç”¨çš„å®Œæ•´é“¾è·¯
  - å¯¹äºå¹¶å‘åœºæ™¯ï¼Œå¿…é¡»ä½¿ç”¨ fork/join èŠ‚ç‚¹
```

### Stage 5: å¹¶å‘æ£€æµ‹ï¼ˆConcurrency Detectionï¼‰

**ç›®æ ‡**ï¼šæ£€æµ‹ä»£ç ä¸­çš„å¹¶å‘æ¨¡å¼å’Œæ½œåœ¨é—®é¢˜ã€‚

**è¾“å…¥æ•°æ®**ï¼š
```yaml
- project_metadata: Stage 1 è¾“å‡º
- code_structure: Stage 2 è¾“å‡º
- execution_trace: Stage 4 è¾“å‡º
- source_files: æºä»£ç æ–‡ä»¶
```

**åˆ†æä»»åŠ¡**ï¼š
1. æ£€æµ‹å¹¶å‘æœºåˆ¶ï¼ˆasyncio, threading, multiprocessingï¼‰
2. è¯†åˆ«å¹¶å‘æµå’ŒåŒæ­¥ç‚¹
3. åˆ†ææ½œåœ¨çš„å¹¶å‘é—®é¢˜ï¼ˆç«æ€æ¡ä»¶ã€æ­»é”ï¼‰

**è¾“å‡ºæ ¼å¼**ï¼š
```json
{
  "concurrency_info": {
    "mechanisms": ["asyncio", "threading"],
    "flows": [
      {
        "id": "uuid-v4",
        "name": "å¼‚æ­¥æ•°æ®åº“æŸ¥è¯¢æµ",
        "type": "asyncio",
        "start_node_id": "node-id",
        "end_node_id": "node-id",
        "sync_points": ["sync-point-id"]
      }
    ],
    "sync_points": [
      {
        "id": "uuid-v4",
        "type": "lock | semaphore | barrier | event",
        "node_id": "node-id",
        "involved_flows": ["flow-id-1", "flow-id-2"],
        "description": "ç­‰å¾…æ•°æ®åº“è¿æ¥é‡Šæ”¾"
      }
    ],
    "potential_issues": [
      {
        "type": "race_condition | deadlock | resource_leak",
        "severity": "high | medium | low",
        "location": "file:line",
        "description": "æè¿°é—®é¢˜",
        "suggestion": "ä¿®å¤å»ºè®®"
      }
    ]
  }
}
```

**å…³é”®æŒ‡ä»¤è¦ç‚¹**ï¼š
```yaml
æ˜ç¡®è¦æ±‚:
  - mechanisms å¿…é¡»ä»å®é™…ä»£ç ä¸­æ£€æµ‹ï¼ˆä¸èƒ½ç¼–é€ ï¼‰
  - flows æè¿°å¹¶å‘æ‰§è¡Œçš„è·¯å¾„
  - sync_points æ ‡è¯†çº¿ç¨‹/åç¨‹çš„åŒæ­¥ç‚¹
  - potential_issues å¿…é¡»åŸºäºé™æ€åˆ†ææ¨ç†
  - severity è¯„çº§å¿…é¡»åˆç†ï¼ˆhigh/medium/lowï¼‰
```

---

## ğŸ“ Prompt æ¨¡æ¿ç»“æ„

### YAML æ–‡ä»¶æ ¼å¼

```yaml
# å…ƒæ•°æ®å—ï¼ˆå¿…éœ€ï¼‰
metadata:
  id: "project-understanding-python-v1.0.0"
  version: "1.0.0"
  stage: "project_understanding"
  target_language: "python"
  created_at: "2025-01-01T00:00:00Z"
  author: "AIFlow Team"
  description: "Pythoné¡¹ç›®çš„é¡¹ç›®è®¤çŸ¥é˜¶æ®µåˆ†æ"
  estimated_tokens: 5000

# Jinja2 æ¨¡æ¿ï¼ˆå¿…éœ€ï¼‰
template: |
  ä½ æ˜¯ä¸€ä¸ªä¸“ç²¾äºæ·±åº¦æºä»£ç åˆ†æçš„AIåŠ©æ‰‹ã€‚

  ## ä»»åŠ¡ç›®æ ‡
  åˆ†æä»¥ä¸‹Pythoné¡¹ç›®ï¼Œå®Œæˆé¡¹ç›®è®¤çŸ¥é˜¶æ®µçš„åˆ†æã€‚

  ## è¾“å…¥æ•°æ®
  - é¡¹ç›®åç§°: {{ project_name }}
  - é¡¹ç›®è·¯å¾„: {{ project_path }}
  - æ–‡ä»¶æ ‘:
  ```
  {{ file_tree }}
  ```

  ## åˆ†æè¦æ±‚
  1. è¯†åˆ«ä¸»è¦ç¼–ç¨‹è¯­è¨€å’Œæ¡†æ¶
  2. æ¨æ–­æ¶æ„æ¨¡å¼
  3. è¯„ä¼°é¡¹ç›®å¤æ‚åº¦

  ## è¾“å‡ºæ ¼å¼
  è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSON Schemaè¾“å‡ºï¼š
  ```json
  {
    "project_metadata": {
      "name": "string",
      "language": "python",
      ...
    }
  }
  ```

  ## çº¦æŸæ¡ä»¶
  - å¿…é¡»åŸºäºå®é™…æ–‡ä»¶å†…å®¹è¿›è¡Œæ¨ç†
  - ä¸è¦ç¼–é€ ä¸å­˜åœ¨çš„ä¿¡æ¯
  - complexity_score èŒƒå›´: 0.0-1.0

# è¾“å…¥æ•°æ® Schemaï¼ˆå¿…éœ€ï¼‰
input_schema:
  type: object
  required:
    - project_name
    - project_path
    - file_tree
  properties:
    project_name:
      type: string
    project_path:
      type: string
    file_tree:
      type: string

# è¾“å‡ºæ•°æ® Schemaï¼ˆå¿…éœ€ï¼‰
output_schema:
  type: object
  required:
    - project_metadata
  properties:
    project_metadata:
      type: object
      # ... è¯¦ç»† schema

# ç¤ºä¾‹ï¼ˆå¯é€‰ä½†æ¨èï¼‰
examples:
  - input:
      project_name: "MyApp"
      project_path: "/path/to/project"
      file_tree: "..."
    output:
      project_metadata:
        name: "MyApp"
        language: "python"
        # ...
```

### Jinja2 å˜é‡å’Œè¿‡æ»¤å™¨

**å†…ç½®å˜é‡**ï¼š
```jinja2
{{ project_name }}      # é¡¹ç›®åç§°
{{ project_path }}      # é¡¹ç›®è·¯å¾„
{{ file_tree }}         # æ–‡ä»¶æ ‘
{{ source_files }}      # æºæ–‡ä»¶åˆ—è¡¨
{{ previous_stage }}    # ä¸Šä¸€é˜¶æ®µè¾“å‡º
```

**è‡ªå®šä¹‰è¿‡æ»¤å™¨**ï¼š
```jinja2
{{ timestamp | format_datetime }}           # æ ¼å¼åŒ–æ—¶é—´æˆ³
{{ data | to_json }}                        # è½¬æ¢ä¸ºJSON
{{ long_text | truncate(100) }}             # æˆªæ–­æ–‡æœ¬
{{ source_code | highlight('python') }}     # ä»£ç é«˜äº®
```

### æ¡ä»¶å’Œå¾ªç¯

```jinja2
{% if project_metadata.framework %}
  è¯†åˆ«åˆ°çš„æ¡†æ¶: {{ project_metadata.framework | join(', ') }}
{% else %}
  æœªæ£€æµ‹åˆ°æ˜ç¡®çš„æ¡†æ¶
{% endif %}

{% for file in source_files %}
  - æ–‡ä»¶ {{ loop.index }}: {{ file.path }}
{% endfor %}
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ç»“æ„åŒ–æ€è€ƒæ ‡ç­¾

**ä½¿ç”¨ XML æ ‡ç­¾å¼•å¯¼ AI æ€è€ƒ**ï¼š

```xml
<thinking>
  åˆ†ææ­¥éª¤ï¼š
  1. æ‰«æé¡¹ç›®æ–‡ä»¶æ ‘
  2. è¯†åˆ«ä¸»è¦æŠ€æœ¯æ ˆ
  3. æ¨æ–­æ¶æ„æ¨¡å¼
</thinking>

<analysis>
  åŸºäºä»¥ä¸‹è¯æ®ï¼š
  - package.json åŒ…å« "react"
  - src/ ç›®å½•ä¸‹æœ‰ components/
  - ä½¿ç”¨äº† Redux çŠ¶æ€ç®¡ç†

  ç»“è®ºï¼šè¿™æ˜¯ä¸€ä¸ªReactå•é¡µåº”ç”¨
</analysis>

<output>
  {
    "project_metadata": { ... }
  }
</output>
```

### 2. åˆ†æ­¥éª¤æŒ‡ä»¤

```yaml
## Step 1: READMEå¯é æ€§è¯„ä¼°
é¦–å…ˆï¼Œè¯„ä¼°README.mdçš„å¯é æ€§ï¼š
- å¯é ï¼šå†…å®¹è¯¦ç»†ã€ä¸ä»£ç ä¸€è‡´
- éƒ¨åˆ†å¯é ï¼šå†…å®¹ç®€ç•¥æˆ–éƒ¨åˆ†è¿‡æ—¶
- ä¸å¯é ï¼šç¼ºå¤±æˆ–ä¸¥é‡è¿‡æ—¶

## Step 2: é™æ€ç»“æ„åˆ†æ
åŸºäºæ–‡ä»¶æ ‘å’Œä¾èµ–æ–‡ä»¶ï¼Œè¯†åˆ«ï¼š
- æŠ€æœ¯æ ˆ
- ç›®å½•ç»„ç»‡æ–¹å¼
- æ¨¡å—åˆ’åˆ†

## Step 3: è¿è¡Œè¡Œä¸ºæ¨ç†
æ¨æ–­æ ¸å¿ƒä¸šåŠ¡åœºæ™¯çš„æ‰§è¡Œè·¯å¾„

## Step 4: è¾“å‡ºJSON
ä¸¥æ ¼æŒ‰ç…§Schemaè¾“å‡º
```

### 3. ç¤ºä¾‹é©±åŠ¨

```yaml
## è¾“å‡ºç¤ºä¾‹

âœ… æ­£ç¡®ç¤ºä¾‹ï¼š
{
  "nodes": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "label": "ç”¨æˆ·è®¤è¯æ¨¡å—",
      "stereotype": "module"
    }
  ]
}

âŒ é”™è¯¯ç¤ºä¾‹ï¼š
{
  "nodes": [
    {
      "id": "1",  // âŒ ä¸æ˜¯UUID v4
      "label": "UserAuth",  // âŒ ä¸æ˜¯ä¸šåŠ¡è¯­ä¹‰åŒ–
      "stereotype": "mod"  // âŒ ä¸åœ¨å…è®¸å€¼åˆ—è¡¨ä¸­
    }
  ]
}
```

### 4. ç½®ä¿¡åº¦æ ‡æ³¨

```yaml
## æ¨ç†ç½®ä¿¡åº¦

å¯¹äºæ¯ä¸ªæ¨æ–­ï¼Œå¿…é¡»æä¾›ç½®ä¿¡åº¦åˆ†æ•°ï¼š
- 0.9-1.0ï¼šåŸºäºæ˜ç¡®çš„ä»£ç è¯æ®
- 0.7-0.9ï¼šåŸºäºåˆç†çš„é€»è¾‘æ¨ç†
- 0.5-0.7ï¼šåŸºäºæ¨¡å¼åŒ¹é…å’Œç»éªŒ
- 0.0-0.5ï¼šä¸ç¡®å®šçš„çŒœæµ‹ï¼ˆé¿å…ï¼‰

ç¤ºä¾‹ï¼š
{
  "metadata": {
    "ai_confidence": 0.95,
    "ai_explanation": "åŸºäºå‡½æ•°ç­¾åå’Œæ³¨é‡Šæ˜ç¡®æ¨æ–­"
  }
}
```

### 5. è¾¹ç•Œæƒ…å†µå¤„ç†

```yaml
## è¾¹ç•Œæƒ…å†µå¤„ç†è§„åˆ™

1. ç©ºé¡¹ç›®ï¼š
   - å¦‚æœé¡¹ç›®åªæœ‰é…ç½®æ–‡ä»¶ï¼Œæ ‡æ³¨ complexity_score = 0.1
   - nodes æ•°ç»„å¯ä»¥ä¸ºç©º

2. æ— æ³•è¯†åˆ«è¯­è¨€ï¼š
   - è®¾ç½® language = "unknown"
   - framework = []

3. ç¼ºå¤±READMEï¼š
   - description = "ï¼ˆAIåŸºäºä»£ç æ¨æ–­ï¼‰é¡¹ç›®æè¿°..."

4. å¾ªç¯ä¾èµ–ï¼š
   - åœ¨ edges ä¸­æ ‡æ³¨ "is_circular": true

5. é€’å½’å‡½æ•°ï¼š
   - åœ¨ callStack ä¸­ä½¿ç”¨ depth å­—æ®µæ ‡è¯†é€’å½’æ·±åº¦
```

---

## ğŸ“š ç¤ºä¾‹æ¨¡æ¿

### ç»¼åˆåˆ†æ Promptï¼ˆv1.0.0ï¼‰

è¿™æ˜¯ä¸€ä¸ªå•æ¬¡å®Œæˆæ‰€æœ‰ 5 ä¸ªé˜¶æ®µçš„ç»¼åˆæ¨¡æ¿ï¼š

```yaml
metadata:
  id: "comprehensive-project-analysis-v1.0.0"
  version: "1.0.0"
  stage: "comprehensive_analysis"
  target_language: "any"
  description: "å¯¹è½¯ä»¶é¡¹ç›®è¿›è¡Œå…¨é¢çš„å¤šç»´åº¦åˆ†æ"

template: |
  <role>
  ä½ æ˜¯ä¸€ä¸ªä¸“ç²¾äºæ·±åº¦æºä»£ç åˆ†æçš„AIåŠ©æ‰‹ï¼Œèƒ½å¤Ÿç†è§£ä»£ç çš„ç»“æ„ã€è¯­ä¹‰å’Œè¿è¡Œè¡Œä¸ºã€‚
  </role>

  <task>
  å¯¹ä»¥ä¸‹é¡¹ç›®è¿›è¡Œå…¨é¢åˆ†æï¼Œç”Ÿæˆå®Œæ•´çš„æ ‡å‡†åŒ–æ•°æ®ã€‚
  </task>

  <input>
  é¡¹ç›®åç§°: {{ project_name }}
  é¡¹ç›®è·¯å¾„: {{ project_path }}
  æ–‡ä»¶æ ‘:
  ```
  {{ file_tree }}
  ```
  </input>

  <process>
  ## Step 1: æ–‡æ¡£å¯é æ€§è¯„ä¼°
  1. è§£æ README.md
  2. æ‰«æä¾èµ–æ–‡ä»¶
  3. è¯„ä¼°å¯é æ€§ç­‰çº§

  ## Step 2: é™æ€ç»“æ„åˆ†æ
  1. è¯†åˆ«æ¨¡å—å’Œç»„ä»¶
  2. åˆ†æä¾èµ–å…³ç³»
  3. å»ºç«‹å±‚çº§ç»“æ„
  4. ç”Ÿæˆä¸šåŠ¡è¯­ä¹‰åŒ–çš„èŠ‚ç‚¹å’Œè¾¹

  ## Step 3: è¿è¡Œè¡Œä¸ºåˆ†æ
  1. è¯†åˆ« 3-5 ä¸ªæ ¸å¿ƒä¸šåŠ¡åœºæ™¯
  2. æ¨æ–­æ‰§è¡Œè·¯å¾„
  3. ä¼°ç®—æ—¶é—´çº¿ï¼ˆISO 8601æ ¼å¼ï¼‰
  4. è¿½è¸ªå˜é‡ä½œç”¨åŸŸ
  5. æ£€æµ‹å¹¶å‘æ¨¡å¼

  ## Step 4: å¹¶å‘ä¸é«˜çº§æ¨¡å¼
  1. æ£€æµ‹å¹¶å‘æœºåˆ¶
  2. è¯†åˆ«åŒæ­¥ç‚¹
  3. åˆ†ææ½œåœ¨é—®é¢˜
  </process>

  <output>
  è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSON Schemaè¾“å‡ºï¼š
  ```json
  {
    "$schema": "https://aiflow.dev/schemas/analysis-v1.0.0.json",
    "version": "1.0.0",
    "project_metadata": { ... },
    "code_structure": { ... },
    "behavior_metadata": { ... },
    "execution_trace": { ... },
    "concurrency_info": { ... }
  }
  ```
  </output>

  <constraints>
  - æ‰€æœ‰IDå¿…é¡»æ˜¯UUID v4æ ¼å¼
  - æ‰€æœ‰æ—¶é—´æˆ³å¿…é¡»æ˜¯ISO 8601æ ¼å¼
  - execution_orderå¿…é¡»å…¨å±€å”¯ä¸€é€’å¢
  - èŠ‚ç‚¹IDå¿…é¡»åœ¨edgesä¸­å¼•ç”¨å‰å­˜åœ¨
  - labelå’Œnameå¿…é¡»ä½¿ç”¨ä¸šåŠ¡è¯­ä¹‰åŒ–çš„ä¸­æ–‡
  - ä¸è¦ç¼–é€ ä¸å­˜åœ¨çš„ä»£ç 
  - å¿…é¡»æä¾›ai_confidenceå’Œai_explanation
  </constraints>
```

---

## âš¡ ä¼˜åŒ–æŠ€å·§

### 1. Token ä¼˜åŒ–

**é—®é¢˜**ï¼šPrompt è¿‡é•¿å¯¼è‡´æˆæœ¬é«˜ã€å“åº”æ…¢ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

```yaml
1. ä½¿ç”¨ç®€æ´çš„æŒ‡ä»¤ï¼š
   âŒ "è¯·ä½ ä»”ç»†åˆ†æè¿™ä¸ªé¡¹ç›®ï¼Œå¹¶ä¸”è¦æ³¨æ„..."
   âœ… "åˆ†æé¡¹ç›®ï¼Œè¦æ±‚ï¼š"

2. å¼•ç”¨è€Œéå¤åˆ¶ï¼š
   âŒ åœ¨Promptä¸­ç²˜è´´å®Œæ•´Schema
   âœ… "è¾“å‡ºæ ¼å¼å‚è€ƒ: analysis-schema-v1.0.0.json"

3. åˆ†é˜¶æ®µè€Œéä¸€æ¬¡æ€§ï¼š
   âŒ ä¸€ä¸ªè¶…é•¿Promptå®Œæˆæ‰€æœ‰åˆ†æ
   âœ… 5ä¸ªä¸­ç­‰Promptï¼Œé€æ­¥æ·±å…¥

4. ä½¿ç”¨ç¤ºä¾‹è€Œéè¯¦ç»†æè¿°ï¼š
   âŒ ç”¨1000å­—æè¿°è¾“å‡ºæ ¼å¼
   âœ… ç»™1ä¸ªå®Œæ•´çš„JSONç¤ºä¾‹
```

### 2. å‡†ç¡®æ€§ä¼˜åŒ–

**é—®é¢˜**ï¼šAI è¾“å‡ºä¸ç¬¦åˆé¢„æœŸæ ¼å¼æˆ–åŒ…å«é”™è¯¯ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

```yaml
1. æ˜ç¡®çº¦æŸï¼š
   "UUIDå¿…é¡»æ˜¯v4æ ¼å¼: xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx"

2. æä¾›åä¾‹ï¼š
   "âŒ é”™è¯¯: 'id': '1'  # ä¸æ˜¯UUID
    âœ… æ­£ç¡®: 'id': '550e8400-e29b-41d4-a716-446655440000'"

3. ç»“æ„åŒ–æ ‡ç­¾ï¼š
   ä½¿ç”¨<thinking>ã€<analysis>ã€<output>å¼•å¯¼æ€è€ƒ

4. ç½®ä¿¡åº¦è¦æ±‚ï¼š
   "å¯¹äºæ¯ä¸ªæ¨æ–­ï¼Œå¿…é¡»æä¾›0-1çš„ç½®ä¿¡åº¦åˆ†æ•°"

5. è¯æ®è¦æ±‚ï¼š
   "åœ¨ai_explanationä¸­è¯´æ˜æ¨ç†ä¾æ®"
```

### 3. é²æ£’æ€§ä¼˜åŒ–

**é—®é¢˜**ï¼šç‰¹æ®Šé¡¹ç›®å¯¼è‡´ AI è¾“å‡ºå¼‚å¸¸ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

```yaml
1. è¾¹ç•Œæƒ…å†µæ˜ç¡®ï¼š
   "å¦‚æœé¡¹ç›®ä¸ºç©ºï¼Œnodeså¯ä»¥ä¸ºç©ºæ•°ç»„"

2. é™çº§ç­–ç•¥ï¼š
   "å¦‚æœæ— æ³•è¯†åˆ«æ¡†æ¶ï¼Œè®¾ç½®framework=[]"

3. é”™è¯¯æ¢å¤ï¼š
   "å¦‚æœé‡åˆ°æ— æ³•è§£æçš„æ–‡ä»¶ï¼Œè·³è¿‡å¹¶åœ¨metadataä¸­æ ‡æ³¨"

4. é»˜è®¤å€¼ï¼š
   "å¦‚æœæ— æ³•æ¨æ–­complexity_scoreï¼Œè®¾ç½®ä¸º0.5"
```

### 4. å¯ç»´æŠ¤æ€§ä¼˜åŒ–

**é—®é¢˜**ï¼šæ¨¡æ¿éš¾ä»¥ç»´æŠ¤å’Œç‰ˆæœ¬ç®¡ç†ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

```yaml
1. æ¨¡å—åŒ–ï¼š
   å°†é€šç”¨éƒ¨åˆ†æå–ä¸ºJinja2å®ï¼š
   {% from 'common.j2' import output_format_section %}

2. ç‰ˆæœ¬åŒ–ï¼š
   æ–‡ä»¶å‘½å: stage-language-vX.Y.Z.yaml
   å…ƒæ•°æ®: versionå­—æ®µ

3. æ³¨é‡Šï¼š
   åœ¨æ¨¡æ¿ä¸­æ·»åŠ æ³¨é‡Šè¯´æ˜è®¾è®¡æ„å›¾

4. æ–‡æ¡£åŒ–ï¼š
   æ¯ä¸ªæ¨¡æ¿éƒ½æœ‰å¯¹åº”çš„è®¾è®¡æ–‡æ¡£

5. æµ‹è¯•ï¼š
   ä¸ºæ¯ä¸ªæ¨¡æ¿ç¼–å†™å•å…ƒæµ‹è¯•
```

---

## ğŸ“– å‚è€ƒèµ„æ–™

- [Jinja2 æ¨¡æ¿è¯­æ³•](https://jinja.palletsprojects.com/)
- [JSON Schema è§„èŒƒ](https://json-schema.org/)
- [Anthropic Prompt Engineering](https://docs.anthropic.com/claude/docs/prompt-engineering)
- [OpenAI Best Practices](https://platform.openai.com/docs/guides/prompt-engineering)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
**æœ€åæ›´æ–°**: 2025-01-12
**ç»´æŠ¤è€…**: AIFlow Team
