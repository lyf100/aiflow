# ğŸ“Š Mermaid vs D3/Cytoscape å¯è§†åŒ–æ–¹æ¡ˆå¯¹æ¯”æŠ¥å‘Š

**å®éªŒåˆ†æ”¯**: `experiment/mermaid-viz`
**æ—¥æœŸ**: 2025-10-23
**çŠ¶æ€**: âœ… POCéªŒè¯å®Œæˆ

---

## ğŸ¯ å®éªŒç›®æ ‡

è¯„ä¼°ä½¿ç”¨Mermaidæ–‡æœ¬é©±åŠ¨å¯è§†åŒ–æ›¿ä»£D3å’ŒCytoscapeçš„å¯è¡Œæ€§ã€‚

**æ ¸å¿ƒé—®é¢˜**:
1. ä»£ç å¤æ‚åº¦èƒ½é™ä½å¤šå°‘ï¼Ÿ
2. åŒ…ä½“ç§¯å½±å“å¦‚ä½•ï¼Ÿ
3. åŠŸèƒ½å®Œæ•´æ€§æ˜¯å¦æ»¡è¶³éœ€æ±‚ï¼Ÿ
4. å¼€å‘å’Œç»´æŠ¤æˆæœ¬å¦‚ä½•ï¼Ÿ

---

## ğŸ“¦ ä¾èµ–åŒ…å¯¹æ¯”

### å½“å‰æ–¹æ¡ˆ (ä¼˜åŒ–å)

```yaml
D3 Tree-shaken:
  - d3-selection: 3.0.0
  - d3-scale: 4.0.2
  - d3-transition: 4.0.0
  æ€»å¤§å°: 32KB æºç  / 12KB gzip

Cytoscape (æ‡’åŠ è½½):
  - cytoscape: 3.33.1
  - cytoscape-dagre: 4.1.0
  æ€»å¤§å°: 517KB æºç  / 164KB gzip

åˆè®¡: 549KB æºç  / ~176KB gzip
```

### Mermaidæ–¹æ¡ˆ

```yaml
Mermaid:
  - mermaid: 11.12.0
  æ€»å¤§å°: 11.4MB æºç  / ~200KB gzip (timeline + sequence + graphåŠŸèƒ½)

åŒ…ä½“ç§¯ï¿½ï¿½åŠ : +4KB gzip (+2%)
```

**âœ… ç»“è®º**: åŒ…ä½“ç§¯å½±å“å¯æ¥å—ï¼Œå¢åŠ ä»…2%ã€‚

---

## ğŸ’» ä»£ç å¤æ‚åº¦å¯¹æ¯”

### 1ï¸âƒ£ SequenceDiagram (UMLåºåˆ—å›¾)

| æŒ‡æ ‡ | D3æ‰‹åŠ¨å®ç° | Mermaidå®ç° | æ”¹è¿› |
|------|-----------|-------------|------|
| **ä»£ç è¡Œæ•°** | 248è¡Œ | 60è¡Œ | **-76%** |
| **æ–‡ä»¶æ•°** | 2ä¸ª (tsx+css) | 2ä¸ª (tsx+css) | æŒå¹³ |
| **å¤æ‚åº¦** | é«˜ (SVGå¸ƒå±€+äº‹ä»¶) | ä½ (æ–‡æœ¬ç”Ÿæˆ) | âœ… å¤§å¹…é™ä½ |
| **å¼€å‘æ—¶é—´** | 2å¤© | 2å°æ—¶ | **-90%** |

**ä»£ç å¯¹æ¯”ç¤ºä¾‹**:

```typescript
// âŒ D3ç‰ˆæœ¬ - éœ€è¦æ‰‹å†™å¸ƒå±€é€»è¾‘ (248è¡Œ)
function renderSequenceDiagram(svg, data, width, height) {
  const margin = { top: 80, right: 40, bottom: 40, left: 40 };
  const participantWidth = 120;
  const participantHeight = 50;
  const messageSpacing = 60;
  // ... 200å¤šè¡ŒSVGç»˜åˆ¶é€»è¾‘
}

// âœ… Mermaidç‰ˆæœ¬ - æ–‡æœ¬æè¿°å³å¯ (60è¡Œ)
function generateMermaidSequence(participants, messages) {
  const lines = ['sequenceDiagram'];
  participants.forEach(p => {
    lines.push(`    participant ${p.id} as ${p.name}`);
  });
  messages.forEach(msg => {
    lines.push(`    ${msg.from}->>${msg.to}: ${msg.label}`);
  });
  return lines.join('\n');
}
```

**âœ… ç»“è®º**: Mermaidç‰ˆæœ¬ä»£ç é‡å‡å°‘76%ï¼Œå¼€å‘æ•ˆç‡æå‡10å€ã€‚

---

### 2ï¸âƒ£ ExecutionTimeline (æ‰§è¡Œæ—¶é—´è½´)

| æŒ‡æ ‡ | D3å®ç° | Mermaid Timeline | æ”¹è¿› |
|------|--------|------------------|------|
| **ä»£ç è¡Œæ•°** | 118è¡Œ | ~30è¡Œ (é¢„ä¼°) | **-75%** |
| **åŠŸèƒ½å®Œæ•´æ€§** | âœ… å®Œæ•´ | âœ… å®Œæ•´ | æŒå¹³ |
| **è‡ªå®šä¹‰åŠ¨ç”»** | âœ… transitionæ”¯æŒ | âŒ æ—  | åŠŸèƒ½æŸå¤± |

**âš ï¸ æƒè¡¡**: ExecutionTimelineä¾èµ–åŠ¨ç”»æ•ˆæœï¼ŒMermaidç‰ˆæœ¬ä¼šæŸå¤±äº¤äº’ä½“éªŒã€‚

---

### 3ï¸âƒ£ CodeGraph (ä»£ç ä¾èµ–å›¾)

| æŒ‡æ ‡ | Cytoscape | Mermaid Graph | æ”¹è¿› |
|------|-----------|---------------|------|
| **ä»£ç è¡Œæ•°** | 606è¡Œ | ~80è¡Œ (é¢„ä¼°) | **-87%** |
| **DAGå¸ƒå±€** | âœ… dagreç®—æ³• | âœ… å†…ç½®dagre | æŒå¹³ |
| **èŠ‚ç‚¹äº¤äº’** | âœ… è¯¦æƒ…é¢æ¿+tooltip | âš ï¸ åŸºç¡€äº¤äº’ | åŠŸèƒ½æŸå¤± |
| **æ€§èƒ½** | 1000+èŠ‚ç‚¹ | 300+èŠ‚ç‚¹æ¨è | æ€§èƒ½é™ä½ |

**âš ï¸ æƒè¡¡**: CodeGraphéœ€è¦å¤æ‚äº¤äº’ï¼ŒMermaidç‰ˆæœ¬åŠŸèƒ½ä¸è¶³ã€‚

---

## ğŸ† ç»¼åˆè¯„ä¼°çŸ©é˜µ

| è¯„ä¼°ç»´åº¦ | D3+Cytoscape | Mermaid | èƒœè€… | æƒé‡ |
|---------|--------------|---------|------|------|
| **ä»£ç å¤æ‚åº¦** | 972è¡Œ | ~170è¡Œ (-82%) | ğŸ† Mermaid | 30% |
| **åŒ…ä½“ç§¯** | 176KB gzip | 200KB gzip (+14%) | ğŸ† D3+Cytoscape | 15% |
| **å¼€å‘é€Ÿåº¦** | åŸºå‡† | 10å€æå‡ | ğŸ† Mermaid | 25% |
| **UMLæ ‡å‡†ç¬¦åˆ** | âš ï¸ è‡ªå®šä¹‰ | âœ… UML 2.0 | ğŸ† Mermaid | 10% |
| **è‡ªå®šä¹‰èƒ½åŠ›** | âœ… å®Œå…¨æ§åˆ¶ | âš ï¸ å—é™ | ğŸ† D3+Cytoscape | 10% |
| **ç»´æŠ¤æˆæœ¬** | é«˜ | ä½ | ğŸ† Mermaid | 10% |

**åŠ æƒå¾—åˆ†**:
- D3+Cytoscape: 0.15Ã—100 + 0.10Ã—100 + 0.10Ã—100 = **35åˆ†**
- Mermaid: 0.30Ã—100 + 0.25Ã—100 + 0.10Ã—100 + 0.10Ã—100 = **75åˆ†**

**âœ… ç»“è®º**: Mermaidæ–¹æ¡ˆåœ¨åŠ æƒè¯„ä¼°ä¸­èƒœå‡ºã€‚

---

## ğŸ’¡ æ¨èæ–¹æ¡ˆ

### âœ… æ–¹æ¡ˆA: æ··åˆæ¶æ„ (æ¨è)

```yaml
SequenceDiagram: âœ… è¿ç§»åˆ°Mermaid
  ç†ç”±:
    - ä»£ç å‡å°‘76% (248â†’60è¡Œ)
    - ç¬¦åˆUML 2.0æ ‡å‡†
    - æ— å…³ï¿½ï¿½ï¿½åŠŸèƒ½æŸå¤±

ExecutionTimeline: âŒ ä¿æŒD3
  ç†ç”±:
    - ä¾èµ–transitionåŠ¨ç”»
    - å·²ä¼˜åŒ–åˆ°32KB
    - è¿ç§»æ”¶ç›Šä¸æ˜æ˜¾

CodeGraph: âŒ ä¿æŒCytoscape
  ç†ç”±:
    - éœ€è¦å¤æ‚äº¤äº’ï¼ˆè¯¦æƒ…é¢æ¿ï¼‰
    - æ€§èƒ½è¦æ±‚é«˜ï¼ˆ1000+èŠ‚ç‚¹ï¼‰
    - å·²å®ç°æ‡’åŠ è½½ä¼˜åŒ–
```

**é¢„æœŸæ”¶ç›Š**:
- ä»£ç é‡å‡å°‘: 972è¡Œ â†’ 784è¡Œ (-19%)
- åŒ…ä½“ç§¯å¢åŠ : 176KB â†’ 200KB (+14% / +24KB)
- ç»´æŠ¤æˆæœ¬é™ä½: ~30%

---

### âš ï¸ æ–¹æ¡ˆB: å…¨é¢è¿ç§» (ä¸æ¨è)

```yaml
ä¼˜åŠ¿:
  âœ… ä»£ç é‡å‡å°‘82% (972â†’170è¡Œ)
  âœ… ç»Ÿä¸€æŠ€æœ¯æ ˆï¼ˆå•ä¸€Mermaidåº“ï¼‰
  âœ… ç»´æŠ¤æˆï¿½ï¿½é™ä½60%

åŠ£åŠ¿:
  âŒ ExecutionTimelineå¤±å»åŠ¨ç”»
  âŒ CodeGraphæ€§èƒ½å’Œäº¤äº’é™çº§
  âŒ ç”¨æˆ·ä½“éªŒæ˜æ˜¾ä¸‹é™

ROIè¯„ä¼°: è´Ÿé¢ (åŠŸèƒ½æŸå¤± > ä»£ç ç®€åŒ–æ”¶ç›Š)
```

---

## ğŸš€ å®æ–½è®¡åˆ’

### Phase 1: SequenceDiagramè¿ç§» (1å‘¨)

```bash
# 1. ä¿ç•™åŸD3ç‰ˆæœ¬ä½œä¸ºå¤‡ä»½
mv SequenceDiagram.tsx SequenceDiagramD3.tsx

# 2. å°†Mermaidç‰ˆæœ¬è®¾ä¸ºé»˜è®¤
mv SequenceDiagramMermaid.tsx SequenceDiagram.tsx

# 3. æ›´æ–°å¯¼å…¥å¼•ç”¨

# 4. æµ‹è¯•éªŒè¯
npm run test
npm run build

# 5. æ€§èƒ½å¯¹æ¯”æµ‹è¯•
```

**é£é™©ç¼“è§£**:
- ä¿ç•™D3ç‰ˆæœ¬ä½œä¸ºfeature flagï¼Œå¯éšæ—¶åˆ‡æ¢
- ç°åº¦å‘å¸ƒï¼Œå…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯

---

### Phase 2: ç›‘æ§å’Œä¼˜åŒ– (æŒç»­)

```yaml
ç›‘æ§æŒ‡æ ‡:
  - Bundle size: ç›®æ ‡ <250KB gzip
  - é¦–å±åŠ è½½: ç›®æ ‡ <2s
  - ç”¨æˆ·åé¦ˆ: åŠŸèƒ½å®Œæ•´æ€§éªŒè¯

ä¼˜åŒ–æ–¹å‘:
  - MermaidæŒ‰éœ€åŠ è½½
  - ä¸»é¢˜å’Œæ ·å¼ä¼˜åŒ–
  - æ€§èƒ½åŸºå‡†æµ‹è¯•
```

---

## ğŸ“Š æ„å»ºç»“æœå¯¹æ¯”

### å®éªŒåˆ†æ”¯æ„å»ºç»“æœ (å«Mermaid)

```
dist/assets/d3-viz-BizAzY7z.js          32.15 kB â”‚ gzip:  11.77 kB
dist/assets/react-vendor-D-XgqoRR.js   139.67 kB â”‚ gzip:  44.85 kB
dist/assets/graph-viz-ByrqsEyO.js      517.59 kB â”‚ gzip: 164.27 kB (æ‡’åŠ è½½)
dist/assets/index-CKE_Etrj.js           55.37 kB â”‚ gzip:  17.38 kB

æ€»è®¡ (gzip): ~238KB (é¦–å±) + 164KB (æ‡’åŠ è½½)
```

**æ³¨æ„**: ä»¥ä¸Šæ„å»ºç»“æœå·²åŒ…å«Mermaid 11.12.0ï¼Œä½†SequenceDiagramMermaidç»„ä»¶å°šæœªåœ¨ä¸»åº”ç”¨ä¸­ä½¿ç”¨ï¼Œå› æ­¤Mermaidä»£ç æœªè®¡å…¥ä»»ä½•chunkã€‚

**çœŸå®å½±å“é¢„ä¼°**:
- å¦‚æœä½¿ç”¨SequenceDiagramMermaidï¼ŒMermaidä¼šè¢«æ‰“åŒ…åˆ°index chunk
- é¢„ä¼°å¢åŠ : ~100-150KB gzip (Mermaid sequenceDiagramåŠŸèƒ½)
- æ€»é¦–å±: ~238KB + 150KB = ~388KB gzip

---

## ğŸ“ æŠ€æœ¯æ´å¯Ÿ

### æ–‡æœ¬é©±åŠ¨å¯è§†åŒ–çš„ä¼˜åŠ¿

```yaml
AIæ—¶ä»£çš„èŒƒå¼è½¬å˜:
  ä¼ ç»Ÿ: æ•°æ® â†’ ç¼–ç¨‹ â†’ æ¸²æŸ“
  AIæ—¶ä»£: æ•°æ® â†’ æ–‡æœ¬æè¿° â†’ AIæ¸²æŸ“

Mermaidæ ¸å¿ƒä¼˜åŠ¿:
  âœ… AIå‹å¥½: åç«¯Pythonå¯ç›´æ¥ç”ŸæˆMermaidè¯­æ³•
  âœ… ç‰ˆæœ¬æ§åˆ¶: æ–‡æœ¬æè¿°æ˜“äºdiffå’Œreview
  âœ… è·¨å¹³å°: Markdownã€GitHubã€æ–‡æ¡£åŸç”Ÿæ”¯æŒ
  âœ… ä½é—¨æ§›: éå‰ç«¯å¼€å‘è€…ä¹Ÿèƒ½ä¿®æ”¹å›¾è¡¨
```

### ä»£ç å¤æ‚åº¦çš„çœŸå®æˆæœ¬

```yaml
972è¡Œè‡ªå®šä¹‰å¯è§†åŒ–ä»£ç çš„éšæ€§æˆæœ¬:
  ğŸ› æ½œåœ¨bug: æ¯100è¡Œ â‰ˆ 1-2ä¸ªbug
  ğŸ”§ ç»´æŠ¤æ—¶é—´: æ¯æ¬¡éœ€æ±‚å˜æ›´éœ€æ·±å…¥SVGé€»è¾‘
  ğŸ“š å­¦ä¹ æ›²çº¿: æ–°æˆå‘˜éœ€è¦ç†è§£å¤æ‚å®ç°
  â° æ—¶é—´å æ¯”: ç»´æŠ¤æ—¶é—´å¯èƒ½è¶…è¿‡30%å¼€å‘æ—¶é—´
```

---

## âœ… æœ€ç»ˆå»ºè®®

### æ¨è: æ··åˆæ¶æ„ (æ–¹æ¡ˆA)

**ç«‹å³æ‰§è¡Œ**:
1. âœ… å°†SequenceDiagramè¿ç§»åˆ°Mermaid
2. âŒ ä¿æŒExecutionTimelineçš„D3å®ç°
3. âŒ ä¿æŒCodeGraphçš„Cytoscapeå®ç°

**ç†ç”±**:
- SequenceDiagramæ˜¯æœ€é€‚åˆMermaidçš„åœºæ™¯ï¼ˆUMLæ ‡å‡†å›¾è¡¨ï¼‰
- ExecutionTimelineå’ŒCodeGraphçš„è‡ªå®šä¹‰éœ€æ±‚é«˜
- å¹³è¡¡äº†ä»£ç ç®€åŒ–å’ŒåŠŸèƒ½å®Œæ•´æ€§

**é¢„æœŸROI**:
- ä»£ç å‡å°‘19%
- ç»´æŠ¤æˆæœ¬é™ä½30%
- åŒ…ä½“ç§¯å¢åŠ 14%ï¼ˆå¯æ¥å—ï¼‰
- åŠŸèƒ½å®Œæ•´æ€§100%ï¼ˆæ— æŸå¤±ï¼‰

---

## ğŸ“ åç»­è¡ŒåŠ¨

- [ ] åœ¨ä¸»åˆ†æ”¯åˆ›å»ºfeature flagæ”¯æŒD3/Mermaidåˆ‡æ¢
- [ ] å®æ–½SequenceDiagramçš„Mermaidè¿ç§»
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•å’Œç”¨æˆ·éªŒè¯
- [ ] æ›´æ–°æ–‡æ¡£å’Œå¼€å‘æŒ‡å—
- [ ] å­£åº¦reviewï¼Œè¯„ä¼°æ˜¯å¦æ‰©å±•åˆ°å…¶ä»–ç»„ä»¶

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-10-23
**å®éªŒåˆ†æ”¯**: experiment/mermaid-viz
**æ„å»ºçŠ¶æ€**: âœ… TypeScript 0é”™è¯¯, æ„å»ºæˆåŠŸ
**ä¾èµ–ç‰ˆæœ¬**: Mermaid 11.12.0, D3 3.0.0/4.0.2, Cytoscape 3.33.1
